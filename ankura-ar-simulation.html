<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ankura AR Agentic LLM Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --primary-dark: #1a252f;
            --highlight: #3498db;
            --highlight-light: #74b9ff;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            
            --billing: #2ecc71;
            --collections: #e67e22;
            --reconciliation: #3498db;
            --dispute: #9b59b6;
            --risk: #e74c3c;
            --reporting: #f1c40f;
            --orchestrator: #34495e;
            
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header-bg {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 40%;
            background: linear-gradient(135deg, transparent, rgba(52, 152, 219, 0.2));
            z-index: 0;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1.2rem;
            font-weight: 500;
        }
        
        .description {
            max-width: 1000px;
            font-size: 1.05rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        
        .key-benefits {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .benefit-item {
            display: flex;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1.2rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        
        .benefit-item:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }
        
        .benefit-icon {
            font-size: 2rem;
            margin-right: 1rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .benefit-text h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: rgba(255, 255, 255, 0.95);
        }
        
        .benefit-text p {
            font-size: 0.9rem;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.85);
        }
        
        .simulation-objective {
            font-size: 1.1rem;
            background-color: rgba(46, 204, 113, 0.2);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid rgba(46, 204, 113, 0.6);
            margin-top: 1rem;
            font-weight: 500;
        }
        
        @media (max-width: 992px) {
            .key-benefits {
                grid-template-columns: 1fr;
            }
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--light);
            margin-bottom: 2rem;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }
        
        .tab.active {
            border-bottom-color: var(--highlight);
            color: var(--highlight);
        }
        
        .tab:hover:not(.active) {
            background-color: var(--light);
            border-radius: 8px 8px 0 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .simulation-controls {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .time-display {
            font-size: 1.2rem;
            font-weight: bold;
            padding: 6px 15px;
            background-color: var(--light);
            border-radius: 6px;
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .speed-label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background-color: var(--highlight);
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .metric-icon {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 2.5rem;
            opacity: 0.1;
        }
        
        .metric-title {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .metric-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--highlight);
            margin-bottom: 10px;
        }
        
        .metric-trend {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .trend-positive {
            color: var(--success);
        }
        
        .trend-negative {
            color: var(--danger);
        }
        
        .trend-icon {
            margin-right: 5px;
        }
        
        .chart-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            height: 400px;
        }
        
        .dashboard-explanation {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .explanation-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--dark);
            text-align: center;
            position: relative;
            padding-bottom: 12px;
        }
        
        .explanation-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 3px;
            background-color: var(--highlight);
            border-radius: 3px;
        }
        
        .explanation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .explanation-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #eaecef;
        }
        
        .explanation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .explanation-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--highlight);
        }
        
        .explanation-card h4 {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: var(--dark);
        }
        
        .explanation-card p {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #555;
        }
        
        .explanation-note {
            background-color: rgba(241, 196, 15, 0.1);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-top: 15px;
            border-left: 4px solid rgba(241, 196, 15, 0.5);
        }
        
        @media (max-width: 992px) {
            .explanation-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .explanation-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Implementation Tab Styles */
        .implementation-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .implementation-overview {
            margin-bottom: 40px;
        }
        
        .architecture-diagram {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid #eaecef;
        }
        
        .architecture-diagram img {
            max-width: 100%;
            height: auto;
        }
        
        .architecture-description {
            font-size: 0.95rem;
            line-height: 1.5;
            margin-top: 15px;
            color: #555;
        }
        
        .implementation-section h3 {
            font-size: 1.4rem;
            margin: 25px 0 20px 0;
            color: var(--dark);
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
        }
        
        .step-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 25px 0;
        }
        
        .step {
            display: flex;
            gap: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 0;
            border: 1px solid #eaecef;
            overflow: hidden;
        }
        
        .step-number {
            background-color: var(--highlight);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .step-content {
            padding: 20px;
            flex: 1;
        }
        
        .step-content h4 {
            margin-bottom: 10px;
            color: var(--dark);
            font-size: 1.2rem;
        }
        
        .step-content p {
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 15px;
            color: #333;
        }
        
        .step-details {
            background-color: rgba(52, 152, 219, 0.05);
            border-radius: 6px;
            padding: 12px 15px;
            font-size: 0.85rem;
        }
        
        .detail-item {
            margin-bottom: 6px;
        }
        
        .detail-title {
            font-weight: bold;
            color: var(--dark);
            margin-right: 5px;
        }
        
        .detail-content {
            color: #555;
        }
        
        .considerations-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }
        
        .consideration-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #eaecef;
        }
        
        .consideration-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--highlight);
        }
        
        .consideration-card h4 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .consideration-card ul {
            padding-left: 20px;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #444;
        }
        
        .consideration-card li {
            margin-bottom: 8px;
        }
        
        .deployment-intro {
            font-size: 0.95rem;
            margin-bottom: 20px;
        }
        
        .phase-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 25px 0;
        }
        
        .phase {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #eaecef;
        }
        
        .phase-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .phase-icon {
            font-size: 1.5rem;
            color: var(--highlight);
        }
        
        .phase-header h4 {
            font-size: 1.1rem;
            color: var(--dark);
            margin: 0;
        }
        
        .phase-content {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #333;
            padding-left: 40px;
        }
        
        .phase-content p {
            margin-bottom: 10px;
        }
        
        .tech-stack-table {
            margin: 25px 0;
            border: 1px solid #eaecef;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .tech-stack-row {
            display: grid;
            grid-template-columns: 1fr 2fr 2fr;
            border-bottom: 1px solid #eaecef;
        }
        
        .tech-stack-row:last-child {
            border-bottom: none;
        }
        
        .header-row {
            background-color: #f1f5f9;
            font-weight: bold;
        }
        
        .tech-stack-cell {
            padding: 12px 15px;
            font-size: 0.9rem;
            border-right: 1px solid #eaecef;
        }
        
        .tech-stack-cell:last-child {
            border-right: none;
        }
        
        .roi-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 25px 0;
        }
        
        .roi-metric {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid #eaecef;
        }
        
        .roi-metric-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--highlight);
            margin-bottom: 10px;
        }
        
        .roi-metric-label {
            font-size: 1rem;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .roi-metric-calculation {
            font-size: 0.85rem;
            color: #666;
        }
        
        @media (max-width: 992px) {
            .considerations-grid, .roi-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tech-stack-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .tech-stack-cell:nth-child(3) {
                grid-column: span 2;
                border-top: 1px solid #eaecef;
            }
        }
        
        @media (max-width: 768px) {
            .considerations-grid, .roi-metrics {
                grid-template-columns: 1fr;
            }
            
            .tech-stack-row {
                display: flex;
                flex-direction: column;
            }
            
            .tech-stack-cell {
                border-right: none;
                border-bottom: 1px solid #eaecef;
            }
            
            .tech-stack-cell:last-child {
                border-bottom: none;
            }
        }
        
        /* Agent network visualization styles */
        .agent-network-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            position: relative;
            min-height: 750px;
            overflow: hidden;
        }
        
        .agent-network-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0) 50%, rgba(52,152,219,0.05) 100%);
            pointer-events: none;
        }
        
        .agent-network-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .agent-network-legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
        
        .legend-text {
            font-weight: 500;
        }
        
        .agent-network {
            position: relative;
            height: 650px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .agent-node {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 2;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            transform: translate(-50%, -50%);
        }
        
        .agent-node::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            background: transparent;
            border: 2px dashed rgba(255,255,255,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .agent-node.active::before {
            opacity: 1;
            animation: pulseNode 1.5s infinite;
        }
        
        @keyframes pulseNode {
            0% { transform: scale(1) translate(-50%, -50%); opacity: 0.7; }
            50% { transform: scale(1.05) translate(-50%, -50%); opacity: 0.9; }
            100% { transform: scale(1) translate(-50%, -50%); opacity: 0.7; }
        }
        
        .agent-node:hover {
            transform: scale(1.1) translate(-45%, -45%);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .agent-node-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .agent-node-name {
            font-size: 0.9rem;
            line-height: 1.2;
        }
        
        .agent-status-indicator {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            bottom: 0;
            right: 0;
            background-color: var(--light);
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .agent-status-idle {
            background-color: #95a5a6;
        }
        
        .agent-status-active {
            background-color: #2ecc71;
        }
        
        .agent-status-processing {
            background-color: #f39c12;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* New agent positioning system using percentages for better responsiveness */
        .node-orchestrator {
            background-color: var(--orchestrator);
            top: 50%;
            left: 50%;
            width: 140px;
            height: 140px;
            z-index: 3;
        }
        
        .node-billing {
            background-color: var(--billing);
            top: 25%;
            left: 20%;
        }
        
        .node-collections {
            background-color: var(--collections);
            top: 25%;
            left: 80%;
        }
        
        .node-reconciliation {
            background-color: var(--reconciliation);
            top: 75%;
            left: 80%;
        }
        
        .node-dispute {
            background-color: var(--dispute);
            top: 75%;
            left: 20%;
        }
        
        .node-risk {
            background-color: var(--risk);
            top: 50%;
            left: 20%;
        }
        
        .node-reporting {
            background-color: var(--reporting);
            top: 50%;
            left: 80%;
        }
        
        .communication-line {
            position: absolute;
            background-color: #ddd;
            height: 3px;
            z-index: 1;
            transform-origin: left center;
            transition: background-color 0.5s ease, height 0.5s ease;
        }
        
        .communication-line.active {
            background-color: rgba(52, 152, 219, 0.8);
            height: 5px;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
            animation: pulseLine 2s;
        }
        
        @keyframes pulseLine {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .thought-bubble {
            position: absolute;
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            width: 200px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: 0.9rem;
            color: var(--dark);
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .thought-bubble::before {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: white;
            transform: rotate(45deg);
        }
        
        .thought-bubble.visible {
            opacity: 1;
            animation: fadeInOut 5s;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }
        
        .thought-bubble.top-right {
            top: -100px;
            right: -20px;
        }
        
        .thought-bubble.top-right::before {
            bottom: -7px;
            right: 30px;
        }
        
        .thought-bubble.top-left {
            top: -100px;
            left: -20px;
        }
        
        .thought-bubble.top-left::before {
            bottom: -7px;
            left: 30px;
        }
        
        .thought-bubble.bottom-right {
            bottom: -100px;
            right: -20px;
        }
        
        .thought-bubble.bottom-right::before {
            top: -7px;
            right: 30px;
        }
        
        .thought-bubble.bottom-left {
            bottom: -100px;
            left: -20px;
        }
        
        .thought-bubble.bottom-left::before {
            top: -7px;
            left: 30px;
        }
        
        .invoice {
            position: absolute;
            width: 40px;
            height: 50px;
            background-color: white;
            border: 2px solid #ddd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 4;
            animation-duration: 15s;
            animation-iteration-count: infinite;
            opacity: 0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .invoice:hover {
            transform: scale(1.1) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .invoice::after {
            content: attr(data-status);
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            background-color: white;
            padding: 2px 5px;
            border-radius: 8px;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .invoice:hover::after {
            opacity: 1;
        }
        
        .invoice1 {
            animation-name: moveInvoice1;
            animation-delay: 0s;
        }
        
        .invoice2 {
            animation-name: moveInvoice2;
            animation-delay: 5s;
        }
        
        .invoice3 {
            animation-name: moveInvoice3;
            animation-delay: 10s;
        }
        
        @keyframes moveInvoice1 {
            0% { 
                left: 20%; 
                top: 25%; 
                opacity: 1;
                transform: scale(1);
            }
            10% { 
                left: 35%; 
                top: 35%; 
                transform: scale(1);
            }
            20% { 
                left: 50%; 
                top: 50%; 
                transform: scale(1.2);
            }
            30% { 
                left: 65%; 
                top: 35%; 
                transform: scale(1);
            }
            40% { 
                left: 80%; 
                top: 25%; 
                transform: scale(1);
            }
            50% { 
                left: 80%; 
                top: 50%; 
                transform: scale(1);
            }
            60% { 
                left: 80%; 
                top: 75%; 
                transform: scale(1);
            }
            70% { 
                left: 50%; 
                top: 65%; 
                transform: scale(1.2);
            }
            80% { 
                left: 20%; 
                top: 75%; 
                transform: scale(1);
            }
            90%, 100% { 
                left: 20%; 
                top: 50%; 
                opacity: 0;
                transform: scale(1);
            }
        }
        
        @keyframes moveInvoice2 {
            0% { 
                left: 20%; 
                top: 25%; 
                opacity: 1;
                transform: scale(1);
            }
            10% { 
                left: 35%; 
                top: 35%; 
                transform: scale(1);
            }
            20% { 
                left: 50%; 
                top: 50%; 
                transform: scale(1.2);
            }
            30% { 
                left: 65%; 
                top: 35%; 
                transform: scale(1);
            }
            40% { 
                left: 80%; 
                top: 25%; 
                transform: scale(1);
            }
            50% { 
                left: 65%; 
                top: 35%; 
                transform: scale(1);
            }
            60% { 
                left: 50%; 
                top: 50%; 
                transform: scale(1.2);
            }
            70% { 
                left: 50%; 
                top: 65%; 
                transform: scale(1);
            }
            80% { 
                left: 65%; 
                top: 75%; 
                transform: scale(1);
            }
            90%, 100% { 
                left: 80%; 
                top: 75%; 
                opacity: 0;
                transform: scale(1);
            }
        }
        
        @keyframes moveInvoice3 {
            0% { 
                left: 80%; 
                top: 25%; 
                opacity: 1; 
                transform: scale(1);
            }
            10% { 
                left: 65%; 
                top: 35%; 
                transform: scale(1);
            }
            20% { 
                left: 50%; 
                top: 50%; 
                transform: scale(1.2);
            }
            30% { 
                left: 35%; 
                top: 35%; 
                transform: scale(1);
            }
            40% { 
                left: 20%; 
                top: 25%; 
                transform: scale(1);
            }
            50% { 
                left: 20%; 
                top: 50%; 
                transform: scale(1);
            }
            60% { 
                left: 20%; 
                top: 75%; 
                transform: scale(1);
            }
            70% { 
                left: 35%; 
                top: 65%; 
                transform: scale(1);
            }
            80% { 
                left: 50%; 
                top: 50%; 
                transform: scale(1.2);
            }
            90%, 100% { 
                left: 50%; 
                top: 25%; 
                opacity: 0;
                transform: scale(1);
            }
        }
        
        /* Agent detail modal */
        .agent-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: var(--border-radius);
            max-width: 700px;
            position: relative;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light);
        }
        
        .modal-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--dark);
        }
        
        .modal-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .modal-section {
            margin-bottom: 25px;
        }
        
        .modal-section-title {
            font-weight: bold;
            margin-bottom: 12px;
            color: var(--dark);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }
        
        .modal-section-title::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 18px;
            background-color: var(--highlight);
            margin-right: 8px;
            border-radius: 2px;
        }
        
        .modal-improvement {
            background-color: rgba(46, 204, 113, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 3px solid rgba(46, 204, 113, 0.5);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .modal-multi-agent {
            background-color: rgba(52, 152, 219, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 3px solid rgba(52, 152, 219, 0.5);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .capability-list {
            list-style: none;
        }
        
        .capability-item {
            padding: 8px 0;
            display: flex;
            align-items: flex-start;
        }
        
        .capability-icon {
            margin-right: 10px;
            color: var(--highlight);
        }
        
        /* Agents grid for Agents tab */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .agent-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 0;
            box-shadow: var(--box-shadow);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--light);
            cursor: pointer;
        }
        
        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .agent-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--light);
        }
        
        .agent-icon {
            font-size: 1.8rem;
            margin-right: 15px;
        }
        
        .agent-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .agent-content {
            padding: 15px;
        }
        
        .agent-description {
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .agent-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            background-color: var(--light);
        }
        
        .status-active {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        /* Activity log styles */
        .activity-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .section-description {
            color: var(--gray);
            margin-bottom: 20px;
        }
        
        .activity-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-select {
            padding: 8px 15px;
            border: 1px solid var(--light);
            border-radius: 4px;
            background-color: white;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .activity-feed {
            background-color: var(--light);
            border-radius: var(--border-radius);
            padding: 20px;
            height: 650px;
            overflow-y: auto;
        }
        
        .activity-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid var(--highlight);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .activity-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .activity-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0) 75%, rgba(52,152,219,0.1) 100%);
            z-index: 0;
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            position: relative;
        }
        
        .activity-agent {
            display: flex;
            align-items: center;
            font-weight: bold;
        }
        
        .activity-agent-icon {
            margin-right: 10px;
            font-size: 1.2rem;
            transform: scale(1);
            transition: transform 0.2s ease;
        }
        
        .activity-item:hover .activity-agent-icon {
            transform: scale(1.2);
        }
        
        .activity-time {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .activity-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-bottom: 8px;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .activity-item:hover .activity-type {
            padding: 3px 12px;
        }
        
        .activity-type-decision {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--highlight);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .activity-type-action {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .activity-type-communication {
            background-color: rgba(155, 89, 182, 0.2);
            color: var(--dispute);
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .activity-type-analysis {
            background-color: rgba(241, 196, 15, 0.2);
            color: var(--reporting);
            border: 1px solid rgba(241, 196, 15, 0.3);
        }
        
        .activity-message {
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            font-weight: 500;
        }
        
        .activity-reasoning {
            background-color: rgba(52, 73, 94, 0.05);
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--dark);
            font-style: italic;
            position: relative;
            border-left: 3px solid rgba(52, 73, 94, 0.2);
            transition: all 0.3s ease;
        }
        
        .activity-item:hover .activity-reasoning {
            background-color: rgba(52, 73, 94, 0.08);
            padding-left: 20px;
        }
        
        .activity-thought-bubble {
            position: relative;
            margin-top: 15px;
            background-color: rgba(52, 152, 219, 0.08);
            border-radius: 8px;
            padding: 15px;
            font-size: 0.9rem;
            border: 1px dashed rgba(52, 152, 219, 0.3);
            display: none;
        }
        
        .activity-thought-bubble::before {
            content: '🧠 Thought Process';
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--highlight);
            font-size: 0.85rem;
        }
        
        .activity-item:hover .activity-thought-bubble {
            display: block;
        }
        
        .activity-connections {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed rgba(0,0,0,0.1);
            font-size: 0.85rem;
            display: none;
        }
        
        .activity-connections-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .connection-item {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
        }
        
        .connection-icon {
            margin-right: 8px;
            font-size: 0.9rem;
            color: var(--highlight);
        }
        
        .activity-item:hover .activity-connections {
            display: block;
        }
        
        /* Invoice styles */
        .invoices-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .invoice-filters {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .search-box input {
            padding: 8px 15px;
            border: 1px solid var(--light);
            border-radius: 4px;
            width: 250px;
            font-size: 0.9rem;
        }
        
        .invoice-table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .invoice-table th,
        .invoice-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light);
        }
        
        .invoice-table th {
            background-color: var(--light);
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .invoice-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-draft {
            background-color: rgba(149, 165, 166, 0.2);
            color: var(--gray);
        }
        
        .status-sent {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--highlight);
        }
        
        .status-pending {
            background-color: rgba(241, 196, 15, 0.2);
            color: #d35400;
        }
        
        .status-overdue {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
        
        .status-disputed {
            background-color: rgba(155, 89, 182, 0.2);
            color: var(--dispute);
        }
        
        .status-paid {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .invoice-actions {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 3px 8px;
            border: none;
            border-radius: 3px;
            font-size: 0.75rem;
            cursor: pointer;
            background-color: var(--light);
            transition: var(--transition);
        }
        
        .action-btn:hover {
            background-color: var(--highlight);
            color: white;
        }
        
        .invoice-stats {
            display: flex;
            justify-content: space-between;
            background-color: var(--light);
            border-radius: var(--border-radius);
            padding: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-right: 5px;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--dark);
        }
        
        /* Invoice modal styles */
        .invoice-details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-gap: 15px;
        }
        
        .invoice-detail-item {
            margin-bottom: 12px;
        }
        
        .invoice-detail-label {
            font-size: 0.9rem;
            color: var(--gray);
            display: block;
            margin-bottom: 4px;
        }
        
        .invoice-detail-value {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .invoice-status-large {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 500;
            margin: 10px 0;
        }
        
        .invoice-agent-processing {
            background-color: rgba(52, 73, 94, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .invoice-agent-reasoning {
            background-color: rgba(52, 152, 219, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid rgba(52, 152, 219, 0.3);
        }
        
        .invoice-timeline {
            position: relative;
            padding-left: 40px;
            margin: 20px 0;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -30px;
            top: 0;
            width: 2px;
            height: 100%;
            background-color: #ddd;
        }
        
        .timeline-item:last-child:before {
            height: 15px;
        }
        
        .timeline-dot {
            position: absolute;
            left: -38px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid var(--highlight);
            z-index: 2;
        }
        
        .timeline-date {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .timeline-agent {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .timeline-agent-icon {
            margin-right: 8px;
        }
        
        .timeline-agent-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .timeline-content {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .timeline-action {
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .timeline-reasoning {
            font-size: 0.9rem;
            font-style: italic;
            color: var(--dark);
            border-left: 2px solid var(--light);
            padding-left: 10px;
            margin-top: 8px;
        }
        
        .timeline-item.active .timeline-dot {
            background-color: var(--highlight);
            border-color: var(--highlight);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
        }
        
        .timeline-item.active .timeline-content {
            background-color: rgba(52, 152, 219, 0.05);
            border-left: 3px solid var(--highlight);
        }
        
        /* Responsive styles */
        @media (max-width: 992px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .agents-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .invoice-details-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .agents-grid {
                grid-template-columns: 1fr;
            }
            
            .simulation-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
            }
            
            .tab {
                padding: 10px 15px;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-bg"></div>
            <div class="header-content">
                <h1>Ankura AR Agentic LLM Simulation</h1>
                <p class="subtitle">Decreasing Days Sales Outstanding with Intelligent Multi-Agent Systems</p>
                <p class="description">
                    This simulation showcases how a specialized team of collaborative LLM-powered AI agents can dramatically transform accounts receivable processes. Each agent uses advanced reasoning capabilities to make intelligent, context-aware decisions while working together toward the shared goal of reducing DSO and improving cash flow.
                </p>
                <div class="key-benefits">
                    <div class="benefit-item">
                        <div class="benefit-icon">🧠</div>
                        <div class="benefit-text">
                            <h3>Superior Reasoning</h3>
                            <p>Unlike traditional automation, these agents use LLM reasoning to understand context, extract meaning from unstructured data, and make nuanced decisions that previously required human judgment.</p>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">⚙️</div>
                        <div class="benefit-text">
                            <h3>Specialized Expertise</h3>
                            <p>Each agent is fine-tuned for a specific AR function (billing, collections, reconciliation, etc.), allowing them to develop deep expertise while maintaining a unified workflow through collaboration.</p>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">🔄</div>
                        <div class="benefit-text">
                            <h3>Adaptive Learning</h3>
                            <p>The multi-agent approach enables continuous improvement through shared learning. As agents encounter new scenarios, they adapt strategies and share insights across the network, creating an increasingly effective system.</p>
                        </div>
                    </div>
                </div>
                <p class="simulation-objective">Watch as these agents work together to reduce DSO from 45 to 30 days while improving collection effectiveness from 78% to 94% through intelligent, reasoned actions rather than static rules.</p>
            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="agents">Agents</div>
            <div class="tab" data-tab="network">Agent Network</div>
            <div class="tab" data-tab="activity">Activity Log</div>
            <div class="tab" data-tab="invoices">Invoices</div>
            <div class="tab" data-tab="implementation">Implementation</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-content">
            <div class="simulation-controls">
                <div class="time-display">
                    Day: <span id="current-day">1</span> | Month: <span id="current-month">January</span>
                </div>
                <div class="control-group">
                    <div class="speed-control">
                        <span class="speed-label">Speed:</span>
                        <input type="range" min="1" max="10" value="5" id="speed-slider">
                    </div>
                    <button id="start-btn" class="btn">Start Simulation</button>
                    <button id="pause-btn" class="btn btn-warning" disabled>Pause</button>
                    <button id="reset-btn" class="btn btn-danger">Reset</button>
                </div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">📊</div>
                    <div class="metric-title">DAYS SALES OUTSTANDING (DSO)</div>
                    <div class="metric-value" id="dso-value">45</div>
                    <div class="metric-trend" id="dso-trend">
                        <span class="trend-icon">⚡</span> 
                        <span>Target: 30 days</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">💰</div>
                    <div class="metric-title">COLLECTION EFFECTIVENESS</div>
                    <div class="metric-value" id="collection-value">78%</div>
                    <div class="metric-trend" id="collection-trend">
                        <span class="trend-icon trend-positive">↗</span>
                        <span>Improving with AI agents</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">📄</div>
                    <div class="metric-title">OUTSTANDING INVOICES</div>
                    <div class="metric-value" id="invoice-value">125</div>
                    <div class="metric-trend" id="invoice-trend">
                        <span class="trend-icon trend-negative">↘</span>
                        <span>Decreasing with automation</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">⚠️</div>
                    <div class="metric-title">OVERDUE AMOUNT</div>
                    <div class="metric-value" id="overdue-value">$850K</div>
                    <div class="metric-trend" id="overdue-trend">
                        <span class="trend-icon trend-negative">↘</span>
                        <span>Reducing with AI collections</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="metrics-chart"></canvas>
            </div>
            
            <div class="dashboard-explanation">
                <h3 class="explanation-title">How Multi-Agent LLMs Transform Accounts Receivable</h3>
                <div class="explanation-grid">
                    <div class="explanation-card">
                        <div class="explanation-icon">🧾</div>
                        <h4>Intelligent Invoicing</h4>
                        <p>The Billing Agent uses LLM reasoning to understand complex contract terms, validate line items against agreements, and customize formats based on client preferences—reducing disputes by 65% compared to traditional automation.</p>
                    </div>
                    <div class="explanation-card">
                        <div class="explanation-icon">💬</div>
                        <h4>Adaptive Communication</h4>
                        <p>The Collections Agent analyzes client behavior patterns to determine optimal timing, channel, and content for payment reminders—achieving 43% higher response rates than template-based approaches.</p>
                    </div>
                    <div class="explanation-card">
                        <div class="explanation-icon">🔍</div>
                        <h4>Intelligent Reconciliation</h4>
                        <p>The Reconciliation Agent uses probabilistic matching to automatically connect payments to invoices even with incomplete reference information—reducing manual research time by 82%.</p>
                    </div>
                    <div class="explanation-card">
                        <div class="explanation-icon">⚖️</div>
                        <h4>Context-Aware Dispute Resolution</h4>
                        <p>The Dispute Agent understands the content of client communications, retrieves relevant documentation, and proposes fair solutions based on contract terms—resolving disputes 58% faster.</p>
                    </div>
                    <div class="explanation-card">
                        <div class="explanation-icon">📊</div>
                        <h4>Predictive Insights</h4>
                        <p>The Reporting Agent identifies subtle payment trends and provides actionable recommendations tailored to specific client segments—enabling proactive collection strategies that improve cash flow.</p>
                    </div>
                    <div class="explanation-card">
                        <div class="explanation-icon">🔄</div>
                        <h4>Continuous Collaboration</h4>
                        <p>The orchestrated agent network shares insights across functions, creating a learning system that constantly improves—achieving DSO reductions that are 3.5x greater than traditional automation.</p>
                    </div>
                </div>
                <div class="explanation-note">
                    <strong>Note:</strong> Unlike traditional automation that follows static rules, these agentic LLMs apply human-like reasoning to adapt their strategies based on context, relationships, and business priorities—handling exceptions and ambiguity that previously required human intervention.
                </div>
            </div>
        </div>
        
        <!-- Agents Tab -->
        <div class="tab-content" id="agents-content">
            <div class="agents-grid">
                <div class="agent-card" data-agent="orchestrator">
                    <div class="agent-header" style="background-color: rgba(52, 73, 94, 0.1);">
                        <div class="agent-icon">🟡</div>
                        <h2 class="agent-title">AR Orchestrator Agent</h2>
                    </div>
                    <div class="agent-content">
                        <div class="agent-description">
                            <p>Central coordinator that oversees AR processes, delegates tasks, and handles escalations based on goal-oriented reasoning.</p>
                        </div>
                        <div class="agent-status status-active">Active</div>
                    </div>
                </div>
                
                <div class="agent-card" data-agent="billing">
                    <div class="agent-header" style="background-color: rgba(46, 204, 113, 0.1);">
                        <div class="agent-icon">🟢</div>
                        <h2 class="agent-title">Billing & Invoice Agent</h2>
                    </div>
                    <div class="agent-content">
                        <div class="agent-description">
                            <p>Creates and validates invoices by understanding contract terms and applying context-aware reasoning to billing data.</p>
                        </div>
                        <div class="agent-status status-active">Active</div>
                    </div>
                </div>
                
                <div class="agent-card" data-agent="collections">
                    <div class="agent-header" style="background-color: rgba(230, 126, 34, 0.1);">
                        <div class="agent-icon">🟠</div>
                        <h2 class="agent-title">Collections & Dunning Agent</h2>
                    </div>
                    <div class="agent-content">
                        <div class="agent-description">
                            <p>Optimizes payment reminders and follow-ups by analyzing client payment patterns and determining most effective approaches.</p>
                        </div>
                        <div class="agent-status status-active">Active</div>
                    </div>
                </div>
                
                <div class="agent-card" data-agent="reconciliation">
                    <div class="agent-header" style="background-color: rgba(52, 152, 219, 0.1);">
                        <div class="agent-icon">🔵</div>
                        <h2 class="agent-title">Payment Reconciliation Agent</h2>
                    </div>
                    <div class="agent-content">
                        <div class="agent-description">
                            <p>Matches payments to invoices using probabilistic reasoning, even with incomplete information or complex payment scenarios.</p>
                        </div>
                        <div class="agent-status status-active">Active</div>
                    </div>
                </div>
                
                <div class="agent-card" data-agent="dispute">
                    <div class="agent-header" style="background-color: rgba(155, 89, 182, 0.1);">
                        <div class="agent-icon">🟣</div>
                        <h2 class="agent-title">Dispute & Deduction Agent</h2>
                    </div>
                    <div class="agent-content">
                        <div class="agent-description">
                            <p>Resolves disputes by understanding client communications, retrieving relevant documentation, and proposing fair solutions.</p>
                        </div>
                        <div class="agent-status status-active">Active</div>
                    </div>
                </div>
                
                <div class="agent-card" data-agent="risk">
                    <div class="agent-header" style="background-color: rgba(231, 76, 60, 0.1);">
                        <div class="agent-icon">🟠</div>
                        <h2 class="agent-title">Risk & Compliance Agent</h2>
                    </div>
                    <div class="agent-content">
                        <div class="agent-description">
                            <p>Identifies risk patterns and compliance issues by analyzing transaction data and applying financial regulatory knowledge.</p>
                        </div>
                        <div class="agent-status status-active">Active</div>
                    </div>
                </div>
                
                <div class="agent-card" data-agent="reporting">
                    <div class="agent-header" style="background-color: rgba(241, 196, 15, 0.1);">
                        <div class="agent-icon">🟡</div>
                        <h2 class="agent-title">Reporting & Forecasting Agent</h2>
                    </div>
                    <div class="agent-content">
                        <div class="agent-description">
                            <p>Predicts payment trends and recommends process improvements by analyzing historical data and identifying patterns.</p>
                        </div>
                        <div class="agent-status status-active">Active</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Agent Network Tab -->
        <div class="tab-content" id="network-content">
            <div class="agent-network-container">
                <h2 class="agent-network-title">AI Agent Collaborative Network</h2>
                
                <div class="agent-network-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--orchestrator);"></div>
                        <div class="legend-text">Orchestrator</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--billing);"></div>
                        <div class="legend-text">Billing</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--collections);"></div>
                        <div class="legend-text">Collections</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--reconciliation);"></div>
                        <div class="legend-text">Reconciliation</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--dispute);"></div>
                        <div class="legend-text">Dispute</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--risk);"></div>
                        <div class="legend-text">Risk</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--reporting);"></div>
                        <div class="legend-text">Reporting</div>
                    </div>
                </div>
                
                <div class="agent-network">
                    <!-- Agent nodes -->
                    <div class="agent-node node-orchestrator" data-agent="orchestrator">
                        <div class="agent-node-icon">🟡</div>
                        <div class="agent-node-name">AR Orchestrator Agent</div>
                        <div class="agent-status-indicator agent-status-active">✓</div>
                        <div class="thought-bubble top-right" id="orchestrator-thought">
                            Analyzing overall AR performance metrics to determine optimal resource allocation. Collection rate improving by 2.3% week-over-week.
                        </div>
                    </div>
                    
                    <div class="agent-node node-billing" data-agent="billing">
                        <div class="agent-node-icon">🟢</div>
                        <div class="agent-node-name">Billing Agent</div>
                        <div class="agent-status-indicator agent-status-active">✓</div>
                        <div class="thought-bubble top-left" id="billing-thought">
                            Validating invoice line items against contract terms. Checking rate escalation clauses and approved service levels.
                        </div>
                    </div>
                    
                    <div class="agent-node node-collections" data-agent="collections">
                        <div class="agent-node-icon">🟠</div>
                        <div class="agent-node-name">Collections Agent</div>
                        <div class="agent-status-indicator agent-status-processing">⟳</div>
                        <div class="thought-bubble top-right" id="collections-thought">
                            Analyzing payment patterns for Umbrella Corp. Previous communications resulted in 5-day response time. Optimizing follow-up timing.
                        </div>
                    </div>
                    
                    <div class="agent-node node-reconciliation" data-agent="reconciliation">
                        <div class="agent-node-icon">🔵</div>
                        <div class="agent-node-name">Reconciliation Agent</div>
                        <div class="agent-status-indicator agent-status-active">✓</div>
                        <div class="thought-bubble bottom-right" id="reconciliation-thought">
                            Matching incoming wire transfer to outstanding invoices. Using fuzzy matching on payment reference and amount patterns.
                        </div>
                    </div>
                    
                    <div class="agent-node node-dispute" data-agent="dispute">
                        <div class="agent-node-icon">🟣</div>
                        <div class="agent-node-name">Dispute Agent</div>
                        <div class="agent-status-indicator agent-status-idle">⊘</div>
                        <div class="thought-bubble bottom-left" id="dispute-thought">
                            Reviewing dispute history for Wayne Enterprises. Analyzing contract language to determine correct billing application.
                        </div>
                    </div>
                    
                    <div class="agent-node node-risk" data-agent="risk">
                        <div class="agent-node-icon">🟠</div>
                        <div class="agent-node-name">Risk Agent</div>
                        <div class="agent-status-indicator agent-status-idle">⊘</div>
                        <div class="thought-bubble top-left" id="risk-thought">
                            Monitoring payment pattern anomalies. Detected slowdown in technology sector payments. Evaluating risk adjustment.
                        </div>
                    </div>
                    
                    <div class="agent-node node-reporting" data-agent="reporting">
                        <div class="agent-node-icon">🟡</div>
                        <div class="agent-node-name">Reporting Agent</div>
                        <div class="agent-status-indicator agent-status-active">✓</div>
                        <div class="thought-bubble top-right" id="reporting-thought">
                            Generating cash flow projections based on current collection rates. Forecasting 15% improvement in DSO over next 60 days.
                        </div>
                    </div>
                    
                    <!-- Communication lines connecting to the orchestrator -->
                    <div class="communication-line" id="line-orch-billing" style="width: 30%; height: 2px; top: 50%; left: 35%; transform: translateY(0px) rotate(180deg);"></div>
                    <div class="communication-line" id="line-orch-collections" style="width: 30%; height: 2px; top: 40%; left: 50%; transform: translateY(0px) rotate(135deg);"></div>
                    <div class="communication-line" id="line-orch-reconciliation" style="width: 30%; height: 2px; top: 60%; left: 50%; transform: translateY(0px) rotate(45deg);"></div>
                    <div class="communication-line" id="line-orch-dispute" style="width: 30%; height: 2px; top: 60%; left: 50%; transform: translateY(0px) rotate(-45deg);"></div>
                    <div class="communication-line" id="line-orch-risk" style="width: 30%; height: 2px; top: 50%; left: 35%; transform: translateY(0px) translateX(0px) rotate(180deg);"></div>
                    <div class="communication-line" id="line-orch-reporting" style="width: 30%; height: 2px; top: 50%; left: 50%; transform: translateY(0px) translateX(0px) rotate(0deg);"></div>
                    
                    <!-- Connections between other agents -->
                    <div class="communication-line" id="line-billing-collections" style="width: 60%; height: 2px; top: 25%; left: 20%; transform: translateY(0px) translateX(0px) rotate(0deg);"></div>
                    <div class="communication-line" id="line-collections-reconciliation" style="width: 50%; height: 2px; top: 50%; left: 80%; transform: translateY(0px) translateX(0px) rotate(90deg);"></div>
                    <div class="communication-line" id="line-reconciliation-dispute" style="width: 60%; height: 2px; top: 75%; left: 20%; transform: translateY(0px) translateX(0px) rotate(0deg);"></div>
                    <div class="communication-line" id="line-dispute-risk" style="width: 25%; height: 2px; top: 63%; left: 20%; transform: translateY(0px) translateX(0px) rotate(90deg);"></div>
                    <div class="communication-line" id="line-risk-billing" style="width: 25%; height: 2px; top: 38%; left: 20%; transform: translateY(0px) translateX(0px) rotate(90deg);"></div>
                    <div class="communication-line" id="line-reporting-collections" style="width: 25%; height: 2px; top: 38%; left: 80%; transform: translateY(0px) translateX(0px) rotate(90deg);"></div>
                    <div class="communication-line" id="line-reporting-reconciliation" style="width: 25%; height: 2px; top: 63%; left: 80%; transform: translateY(0px) translateX(0px) rotate(90deg);"></div>
                    
                    <!-- Moving invoices animation -->
                    <div class="invoice invoice1" data-status="Pending Payment">📄</div>
                    <div class="invoice invoice2" data-status="Overdue - 15 days">📄</div>
                    <div class="invoice invoice3" data-status="Disputed">📄</div>
                </div>
            </div>
        </div>
        
        <!-- Agent Detail Modal -->
        <div class="agent-modal" id="agent-modal">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <div class="modal-header">
                    <div class="modal-icon" id="modal-icon">🟡</div>
                    <h3 class="modal-title" id="modal-title">AR Orchestrator Agent</h3>
                </div>
                <div class="modal-description" id="modal-description">
                    The AR Orchestrator Agent serves as the central coordinator for the entire accounts receivable process, using goal-oriented reasoning to prioritize tasks, delegate responsibilities, and ensure optimal cash flow.
                </div>
                <div class="modal-section">
                    <h4 class="modal-section-title">How This Improves Traditional AR:</h4>
                    <p class="modal-improvement">
                        Traditional AR management relies on static rules or human judgment to coordinate processes. The Orchestrator Agent uses sophisticated LLM reasoning to continuously evaluate complex situations, balance competing priorities, and make nuanced decisions that optimize the entire AR workflow - automatically adjusting strategies based on changing business conditions.
                    </p>
                </div>
                <div class="modal-section">
                    <h4 class="modal-section-title">Key LLM Capabilities:</h4>
                    <ul class="capability-list" id="modal-capabilities">
                        <li class="capability-item">
                            <span class="capability-icon">🧠</span>
                            <span>Prioritizes collections based on complex criteria like payment risk, client value, and cash flow needs</span>
                        </li>
                        <li class="capability-item">
                            <span class="capability-icon">🧠</span>
                            <span>Identifies patterns across invoice aging to optimize collection strategies</span>
                        </li>
                        <li class="capability-item">
                            <span class="capability-icon">🧠</span>
                            <span>Makes reasoned decisions about resource allocation based on changing business priorities</span>
                        </li>
                        <li class="capability-item">
                            <span class="capability-icon">🧠</span>
                            <span>Evaluates performance metrics to recommend process improvements</span>
                        </li>
                    </ul>
                </div>
                <div class="modal-section">
                    <h4 class="modal-section-title">Multi-Agent Advantage:</h4>
                    <p class="modal-multi-agent">
                        As the central coordinator, the Orchestrator Agent enables a true multi-agent system where specialized expertise can be applied to specific tasks while maintaining a unified strategy. This creates a network effect where insights from one area of AR immediately benefit all others, leading to continuous system-wide improvement.
                    </p>
                </div>
                <div class="modal-section">
                    <h4 class="modal-section-title">Key Collaborations:</h4>
                    <ul class="capability-list" id="modal-collaborations">
                        <li class="capability-item">
                            <span class="capability-icon">🤝</span>
                            <span>Coordinates with Collections Agent to focus on high-priority accounts</span>
                        </li>
                        <li class="capability-item">
                            <span class="capability-icon">🤝</span>
                            <span>Processes alerts from Risk Agent about compliance concerns</span>
                        </li>
                        <li class="capability-item">
                            <span class="capability-icon">🤝</span>
                            <span>Uses insights from Reporting Agent to adjust overall AR strategy</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Invoice Details Modal -->
        <div class="agent-modal" id="invoice-details-modal">
            <div class="modal-content">
                <span class="modal-close" id="invoice-details-close">&times;</span>
                <div class="modal-header">
                    <div class="modal-icon">📄</div>
                    <h3 class="modal-title" id="invoice-details-title">Invoice Details</h3>
                </div>
                <div class="modal-section">
                    <div class="invoice-details-grid" id="invoice-details-content">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="modal-section">
                    <h4 class="modal-section-title">Agent Processing & Analysis:</h4>
                    <div class="invoice-agent-processing" id="invoice-agent-processing">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="modal-section">
                    <h4 class="modal-section-title">Agent Reasoning:</h4>
                    <div class="invoice-agent-reasoning" id="invoice-agent-reasoning">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Invoice History Modal -->
        <div class="agent-modal" id="invoice-history-modal">
            <div class="modal-content">
                <span class="modal-close" id="invoice-history-close">&times;</span>
                <div class="modal-header">
                    <div class="modal-icon">📋</div>
                    <h3 class="modal-title" id="invoice-history-title">Invoice History</h3>
                </div>
                <div class="modal-section">
                    <div class="invoice-timeline" id="invoice-timeline">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Activity Log Tab -->
        <div class="tab-content" id="activity-content">
            <div class="activity-section">
                <h2 class="section-title">AI Agent Activity Log</h2>
                <p class="section-description">Real-time log of agent activities and reasoning processes.</p>
                
                <div class="activity-filters">
                    <select id="agent-filter" class="filter-select">
                        <option value="all">All Agents</option>
                        <option value="orchestrator">AR Orchestrator</option>
                        <option value="billing">Billing & Invoice</option>
                        <option value="collections">Collections & Dunning</option>
                        <option value="reconciliation">Payment Reconciliation</option>
                        <option value="dispute">Dispute Management</option>
                        <option value="risk">Risk & Compliance</option>
                        <option value="reporting">Reporting & Forecasting</option>
                    </select>
                    
                    <select id="activity-type-filter" class="filter-select">
                        <option value="all">All Activities</option>
                        <option value="decision">Decision Making</option>
                        <option value="action">Actions</option>
                        <option value="communication">Communications</option>
                        <option value="analysis">Analysis</option>
                    </select>
                </div>
                
                <div class="activity-feed" id="activity-feed">
                    <!-- Will be populated dynamically by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Invoices Tab -->
        <div class="tab-content" id="invoices-content">
            <div class="invoices-section">
                <h2 class="section-title">Invoice Management</h2>
                <p class="section-description">View and track invoices as they move through the AR process.</p>
                
                <div class="invoice-filters">
                    <select id="status-filter" class="filter-select">
                        <option value="all">All Statuses</option>
                        <option value="draft">Draft</option>
                        <option value="sent">Sent</option>
                        <option value="pending">Pending Payment</option>
                        <option value="overdue">Overdue</option>
                        <option value="disputed">Disputed</option>
                        <option value="paid">Paid</option>
                    </select>
                    
                    <div class="search-box">
                        <input type="text" id="invoice-search" placeholder="Search invoices...">
                    </div>
                </div>
                
                <div class="invoice-table-container">
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Client</th>
                                <th>Amount</th>
                                <th>Issue Date</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Age (Days)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="invoice-table-body">
                            <!-- Will be populated dynamically by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="invoice-stats">
                    <div class="stat-item">
                        <span class="stat-label">Total Invoices:</span>
                        <span class="stat-value" id="total-invoice-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Outstanding:</span>
                        <span class="stat-value" id="total-outstanding">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Avg. Days to Payment:</span>
                        <span class="stat-value" id="avg-days-to-payment">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Implementation Tab -->
        <div class="tab-content" id="implementation-content">
            <div class="implementation-section">
                <h2 class="section-title">Technical Implementation Approach</h2>
                <p class="section-description">A practical guide to building and deploying a multi-agent agentic LLM system for accounts receivable in a real-world enterprise environment.</p>
                
                <div class="implementation-overview">
                    <h3>System Architecture</h3>
                    <div class="architecture-diagram">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxzdHlsZT4KICAgICAgICAuYm94IHsgc3Ryb2tlOiAjMzQ0OTVFO3N0cm9rZS13aWR0aDogMnB4OyBmaWxsOiAjZjhmOWZhOyB9CiAgICAgICAgLmFycm93IHsgc3Ryb2tlOiAjMzQ0OTVFO3N0cm9rZS13aWR0aDogMnB4OyBmaWxsOiBub25lOyBtYXJrZXItZW5kOiB1cmwoI2Fycm93aGVhZCk7IH0KICAgICAgICAubGFiZWwgeyBmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogMTJweDsgZmlsbDogIzM0NDk1RTsgfQogICAgICAgIC5ib3gtbGFiZWwgeyBmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogMTRweDsgZmlsbDogIzM0NDk1RTsgZm9udC13ZWlnaHQ6IGJvbGQ7IH0KICAgICAgICAuc3ViLWxhYmVsIHsgZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBmb250LXNpemU6IDExcHg7IGZpbGw6ICM3MDcwNzA7IH0KICAgICAgICAuYmctYm94IHsgc3Ryb2tlOiAjMzQ5OGRiOyBzdHJva2Utd2lkdGg6IDJweDsgZmlsbDogcmdiYSg1MiwgMTUyLCAyMTksIDAuMSk7IHN0cm9rZS1kYXNoYXJyYXk6IDU7IH0KICAgIDwvc3R5bGU+CiAgICA8ZGVmcz4KICAgICAgICA8bWFya2VyIGlkPSJhcnJvd2hlYWQiIG1hcmtlcldpZHRoPSIxMCIgbWFya2VySGVpZ2h0PSI3IiByZWZYPSIwIiByZWZZPSIzLjUiIG9yaWVudD0iYXV0byI+CiAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0iMCAwLCAxMCAzLjUsIDAgNyIgZmlsbD0iIzM0NDk1RSIvPgogICAgICAgIDwvbWFya2VyPgogICAgPC9kZWZzPgogICAgCiAgICA8IS0tIEVudGVycHJpc2UgU3lzdGVtcyAtLT4KICAgIDxyZWN0IHg9IjIwIiB5PSIyMCIgd2lkdGg9IjE2MCIgaGVpZ2h0PSIzNjAiIGNsYXNzPSJiZy1ib3giIHJ4PSI1IiAvPgogICAgPHRleHQgeD0iMTAwIiB5PSI0MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9ImJveC1sYWJlbCI+RW50ZXJwcmlzZSBTeXN0ZW1zPC90ZXh0PgogICAgCiAgICA8cmVjdCB4PSI0MCIgeT0iNzAiIHdpZHRoPSIxMjAiIGhlaWdodD0iNTAiIGNsYXNzPSJib3giIHJ4PSI0IiAvPgogICAgPHRleHQgeD0iMTAwIiB5PSI5NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9ImJveC1sYWJlbCI+RVJQICh0cmFuc2FjdGlvbnMpPC90ZXh0PgogICAgCiAgICA8cmVjdCB4PSI0MCIgeT0iMTQwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjUwIiBjbGFzcz0iYm94IiByeD0iNCIgLz4KICAgIDx0ZXh0IHg9IjEwMCIgeT0iMTY1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0iYm94LWxhYmVsIj5DUk0gKGNsaWVudCBkYXRhKTwvdGV4dD4KICAgIAogICAgPHJlY3QgeD0iNDAiIHk9IjIxMCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI1MCIgY2xhc3M9ImJveCIgcng9IjQiIC8+CiAgICA8dGV4dCB4PSIxMDAiIHk9IjIzNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9ImJveC1sYWJlbCI+Q29udHJhY3QgTWdtdDwvdGV4dD4KICAgIAogICAgPHJlY3QgeD0iNDAiIHk9IjI4MCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI1MCIgY2xhc3M9ImJveCIgcng9IjQiIC8+CiAgICA8dGV4dCB4PSIxMDAiIHk9IjMwNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9ImJveC1sYWJlbCI+QmFua2luZyBTeXN0ZW1zPC90ZXh0PgogICAgCiAgICA8IS0tIERhdGEgSW50ZWdyYXRpb24gTGF5ZXIgLS0+CiAgICA8cmVjdCB4PSIyMjAiIHk9IjIwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjM2MCIgY2xhc3M9ImJnLWJveCIgcng9IjUiIC8+CiAgICA8dGV4dCB4PSIyODAiIHk9IjQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0iYm94LWxhYmVsIj5JbnRlZ3JhdGlvbiBMYXllcjwvdGV4dD4KICAgIAogICAgPHJlY3QgeD0iMjQwIiB5PSI3MCIgd2lkdGg9IjgwIiBoZWlnaHQ9IjUwIiBjbGFzcz0iYm94IiByeD0iNCIgLz4KICAgIDx0ZXh0IHg9IjI4MCIgeT0iOTUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJib3gtbGFiZWwiPkFQSXM8L3RleHQ+CiAgICAKICAgIDxyZWN0IHg9IjI0MCIgeT0iMTUwIiB3aWR0aD0iODAiIGhlaWdodD0iNTAiIGNsYXNzPSJib3giIHJ4PSI0IiAvPgogICAgPHRleHQgeD0iMjgwIiB5PSIxNzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJib3gtbGFiZWwiPldlYmhvb2tzPC90ZXh0PgogICAgCiAgICA8cmVjdCB4PSIyNDAiIHk9IjIzMCIgd2lkdGg9IjgwIiBoZWlnaHQ9IjUwIiBjbGFzcz0iYm94IiByeD0iNCIgLz4KICAgIDx0ZXh0IHg9IjI4MCIgeT0iMjU1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0iYm94LWxhYmVsIj5EYXRhIFRyYW5zZm9ybXM8L3RleHQ+CiAgICAKICAgIDxyZWN0IHg9IjI0MCIgeT0iMzEwIiB3aWR0aD0iODAiIGhlaWdodD0iNTAiIGNsYXNzPSJib3giIHJ4PSI0IiAvPgogICAgPHRleHQgeD0iMjgwIiB5PSIzMzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJib3gtbGFiZWwiPkV2ZW50IEJ1czwvdGV4dD4KICAgIAogICAgPCEtLSBBZ2VudCBPcmNoZXN0cmF0aW9uIExheWVyIC0tPgogICAgPHJlY3QgeD0iMzgwIiB5PSIyMCIgd2lkdGg9IjQwMCIgaGVpZ2h0PSIzNjAiIGNsYXNzPSJiZy1ib3giIHJ4PSI1IiAvPgogICAgPHRleHQgeD0iNTgwIiB5PSI0MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9ImJveC1sYWJlbCI+TXVsdGktQWdlbnQgTExNIFN5c3RlbTwvdGV4dD4KICAgIAogICAgPCEtLSBPcmNoZXN0cmF0b3IgQWdlbnQgLS0+CiAgICA8cmVjdCB4PSI0MDAiIHk9IjE1MCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI3MCIgY2xhc3M9ImJveCIgcng9IjQiIHN0eWxlPSJmaWxsOiByZ2JhKDUyLCA3MywgOTQsIDAuMik7IiAvPgogICAgPHRleHQgeD0iNDYwIiB5PSIxNzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJib3gtbGFiZWwiPk9yY2hlc3RyYXRvcjwvdGV4dD4KICAgIDx0ZXh0IHg9IjQ2MCIgeT0iMTkwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0ic3ViLWxhYmVsIj5Hb2FsLW9yaWVudGVkIHBsYW5uaW5nPC90ZXh0PgogICAgCiAgICA8IS0tIFNwZWNpYWxpc3QgQWdlbnRzIC0tPgogICAgPHJlY3QgeD0iNjAwIiB5PSI3MCIgd2lkdGg9IjExMCIgaGVpZ2h0PSI1MCIgY2xhc3M9ImJveCIgcng9IjQiIHN0eWxlPSJmaWxsOiByZ2JhKDQ2LCAyMDQsIDExMywgMC4yKTsiIC8+CiAgICA8dGV4dCB4PSI2NTUiIHk9Ijk1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0iYm94LWxhYmVsIj5CaWxsaW5nIEFnZW50PC90ZXh0PgogICAgCiAgICA8cmVjdCB4PSI2MDAiIHk9IjEzMCIgd2lkdGg9IjExMCIgaGVpZ2h0PSI1MCIgY2xhc3M9ImJveCIgcng9IjQiIHN0eWxlPSJmaWxsOiByZ2JhKDIzMCwgMTI2LCAzNCwgMC4yKTsiIC8+CiAgICA8dGV4dCB4PSI2NTUiIHk9IjE1NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgY2xhc3M9ImJveC1sYWJlbCI+Q29sbGVjdGlvbnMgQWdlbnQ8L3RleHQ+CiAgICAKICAgIDxyZWN0IHg9IjYwMCIgeT0iMTkwIiB3aWR0aD0iMTEwIiBoZWlnaHQ9IjUwIiBjbGFzcz0iYm94IiByeD0iNCIgc3R5bGU9ImZpbGw6IHJnYmEoNTIsIDE1MiwgMjE5LCAwLjIpOyIgLz4KICAgIDx0ZXh0IHg9IjY1NSIgeT0iMjE1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0iYm94LWxhYmVsIj5SZWNvbmNpbGlhdGlvbjwvdGV4dD4KICAgIAogICAgPHJlY3QgeD0iNjAwIiB5PSIyNTAiIHdpZHRoPSIxMTAiIGhlaWdodD0iNTAiIGNsYXNzPSJib3giIHJ4PSI0IiBzdHlsZT0iZmlsbDogcmdiYSgxNTUsIDg5LCAxODIsIDAuMik7IiAvPgogICAgPHRleHQgeD0iNjU1IiB5PSIyNzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGNsYXNzPSJib3gtbGFiZWwiPkRpc3B1dGUgQWdlbnQ8L3RleHQ+CiAgICAKICAgIDxyZWN0IHg9IjYwMCIgeT0iMzEwIiB3aWR0aD0iMTEwIiBoZWlnaHQ9IjUwIiBjbGFzcz0iYm94IiByeD0iNCIgc3R5bGU9ImZpbGw6IHJnYmEoMjQxLCAxOTYsIDE1LCAwLjIpOyIgLz4KICAgIDx0ZXh0IHg9IjY1NSIgeT0iMzM1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBjbGFzcz0iYm94LWxhYmVsIj5SZXBvcnRpbmcgQWdlbnQ8L3RleHQ+CiAgICAKICAgIDwhLS0gQXJyb3dzIGJldHdlZW4gc3lzdGVtcyAtLT4KICAgIDxsaW5lIHgxPSIxNjAiIHkxPSI5NSIgeDI9IjI0MCIgeTI9Ijk1IiBjbGFzcz0iYXJyb3ciLz4KICAgIDxsaW5lIHgxPSIxNjAiIHkxPSIxNjUiIHgyPSIyNDAiIHkyPSIxNjUiIGNsYXNzPSJhcnJvdyIvPgogICAgPGxpbmUgeDE9IjE2MCIgeTE9IjIzNSIgeDI9IjI0MCIgeTI9IjIzNSIgY2xhc3M9ImFycm93Ii8+CiAgICA8bGluZSB4MT0iMTYwIiB5MT0iMzA1IiB4Mj0iMjQwIiB5Mj0iMzA1IiBjbGFzcz0iYXJyb3ciLz4KICAgIAogICAgPGxpbmUgeDE9IjMyMCIgeTE9Ijk1IiB4Mj0iNDAwIiB5Mj0iMTY1IiBjbGFzcz0iYXJyb3ciLz4KICAgIDxsaW5lIHgxPSIzMjAiIHkxPSIxNzUiIHgyPSI0MDAiIHkyPSIxNzUiIGNsYXNzPSJhcnJvdyIvPgogICAgPGxpbmUgeDE9IjMyMCIgeTE9IjI1NSIgeDI9IjQwMCIgeTI9IjE4NSIgY2xhc3M9ImFycm93Ii8+CiAgICA8bGluZSB4MT0iMzIwIiB5MT0iMzM1IiB4Mj0iNDAwIiB5Mj0iMTk1IiBjbGFzcz0iYXJyb3ciLz4KICAgIAogICAgPCEtLSBDb25uZWN0aW9ucyBiZXR3ZWVuIG9yY2hlc3RyYXRvciBhbmQgYWdlbnRzIC0tPgogICAgPGxpbmUgeDE9IjUyMCIgeTE9IjE2NSIgeDI9IjYwMCIgeTI9Ijk1IiBjbGFzcz0iYXJyb3ciLz4KICAgIDxsaW5lIHgxPSI1MjAiIHkxPSIxNzAiIHgyPSI2MDAiIHkyPSIxNTUiIGNsYXNzPSJhcnJvdyIvPgogICAgPGxpbmUgeDE9IjUyMCIgeTE9IjE3NSIgeDI9IjYwMCIgeTI9IjIxNSIgY2xhc3M9ImFycm93Ii8+CiAgICA8bGluZSB4MT0iNTIwIiB5MT0iMTgwIiB4Mj0iNjAwIiB5Mj0iMjc1IiBjbGFzcz0iYXJyb3ciLz4KICAgIDxsaW5lIHgxPSI1MjAiIHkxPSIxODUiIHgyPSI2MDAiIHkyPSIzMzUiIGNsYXNzPSJhcnJvdyIvPgo8L3N2Zz4=" alt="Multi-Agent AR System Architecture" />
                    </div>
                    <p class="architecture-description">
                        The system architecture follows a modular design with bidirectional data flow between enterprise systems and specialized agents. All communication is coordinated through the Orchestrator Agent, which manages goals, priorities, and ensures consistent execution.
                    </p>
                </div>

                <div class="implementation-steps">
                    <h3>Technical Implementation Roadmap</h3>
                    
                    <div class="step-container">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Data Integration Layer</h4>
                                <p>Build secure connectors to enterprise systems (ERP, CRM, contract repositories, banking) using APIs, webhooks, and batch processing. Establish bidirectional data flows for read/write operations with proper permissioning.</p>
                                <div class="step-details">
                                    <div class="detail-item">
                                        <span class="detail-title">Technologies:</span>
                                        <span class="detail-content">REST APIs, GraphQL, database connectors, OAuth, event streaming (Kafka/RabbitMQ)</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-title">Implementation Time:</span>
                                        <span class="detail-content">6-10 weeks (depends on enterprise system complexity)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>LLM Foundation & Agent Framework</h4>
                                <p>Establish the core LLM infrastructure using advanced models like Claude 3 Opus or GPT-4. Implement specialized custom instructions and system prompts for each agent role. Build function calling APIs for system interaction.</p>
                                <div class="step-details">
                                    <div class="detail-item">
                                        <span class="detail-title">Technologies:</span>
                                        <span class="detail-content">LangChain/LlamaIndex, Python/TypeScript, Agent frameworks, vector databases</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-title">Implementation Time:</span>
                                        <span class="detail-content">8-12 weeks (core framework + initial agent implementations)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Secure RAG Knowledge Base</h4>
                                <p>Build specialized retrieval systems per function area (contracts, client communications, payment history, industry benchmarks). Implement hybrid search with semantic and keyword elements for accurate context retrieval.</p>
                                <div class="step-details">
                                    <div class="detail-item">
                                        <span class="detail-title">Technologies:</span>
                                        <span class="detail-content">Weaviate/Pinecone, embedding models, chunking pipeline, metadata filtering</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-title">Implementation Time:</span>
                                        <span class="detail-content">4-6 weeks (initial), ongoing expansion</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Orchestrator & Planning Engine</h4>
                                <p>Implement the core orchestrator logic to coordinate agent activities, manage workflows, and ensure goal attainment. Build planning mechanisms for complex multi-step processes.</p>
                                <div class="step-details">
                                    <div class="detail-item">
                                        <span class="detail-title">Technologies:</span>
                                        <span class="detail-content">Plan-and-execute frameworks, process orchestration, state management</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-title">Implementation Time:</span>
                                        <span class="detail-content">6-8 weeks</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Human-in-the-Loop Components</h4>
                                <p>Create interfaces for human oversight, approval workflows for high-impact decisions, and monitoring dashboards. Implement feedback loops for continuous agent improvement.</p>
                                <div class="step-details">
                                    <div class="detail-item">
                                        <span class="detail-title">Technologies:</span>
                                        <span class="detail-content">React/Angular, notification systems, approval workflows, feedback API</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-title">Implementation Time:</span>
                                        <span class="detail-content">4-8 weeks</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="implementation-considerations">
                    <h3>Key Technical Considerations</h3>
                    
                    <div class="considerations-grid">
                        <div class="consideration-card">
                            <div class="consideration-icon">🔐</div>
                            <h4>Security & Compliance</h4>
                            <ul>
                                <li>Implement end-to-end encryption for all data flows</li>
                                <li>Role-based access control for all agent actions</li>
                                <li>PCI compliance for payment information</li>
                                <li>Audit logging of all agent decisions and actions</li>
                                <li>Data minimization principles (agents only access needed data)</li>
                            </ul>
                        </div>
                        
                        <div class="consideration-card">
                            <div class="consideration-icon">⚡</div>
                            <h4>Technical Performance</h4>
                            <ul>
                                <li>Local embeddings for sensitive financial data</li>
                                <li>Caching strategies for common agent operations</li>
                                <li>Optimized token usage through chunking and retrieval</li>
                                <li>Bulk operations for payment processing</li>
                                <li>Parallel processing for invoice batch analysis</li>
                            </ul>
                        </div>
                        
                        <div class="consideration-card">
                            <div class="consideration-icon">🔄</div>
                            <h4>Integration Approach</h4>
                            <ul>
                                <li>Event-driven architecture for real-time updates</li>
                                <li>Idempotent operations for reliability</li>
                                <li>Well-defined fallback procedures</li>
                                <li>Backward compatibility with legacy systems</li>
                                <li>Modular design for independent component updates</li>
                            </ul>
                        </div>
                        
                        <div class="consideration-card">
                            <div class="consideration-icon">📊</div>
                            <h4>Measurement & Improvement</h4>
                            <ul>
                                <li>A/B testing framework for agent strategies</li>
                                <li>Performance metrics for each agent type</li>
                                <li>Model quality evaluation pipeline</li>
                                <li>Human feedback collection and integration</li>
                                <li>Continuous prompt engineering improvements</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="phased-deployment">
                    <h3>Phased Deployment Strategy</h3>
                    <p class="deployment-intro">A realistic implementation should follow a phased approach with clear evaluation criteria at each stage:</p>
                    
                    <div class="phase-container">
                        <div class="phase">
                            <div class="phase-header">
                                <div class="phase-icon">🔍</div>
                                <h4>Phase 1: Agent-Assisted Operations</h4>
                            </div>
                            <div class="phase-content">
                                <p>Deploy agents in advisory mode with human operators making final decisions. Start with Collections Agent for payment reminders and Reconciliation Agent for payment matching.</p>
                                <p><strong>Timeline:</strong> 3-4 months</p>
                                <p><strong>Success Metrics:</strong> 20% reduction in manual reconciliation time, 15% improvement in payment response rates</p>
                            </div>
                        </div>
                        
                        <div class="phase">
                            <div class="phase-header">
                                <div class="phase-icon">🤖</div>
                                <h4>Phase 2: Semi-Automated Workflows</h4>
                            </div>
                            <div class="phase-content">
                                <p>Enable automated execution for low-risk, high-confidence actions (standard reminders, matching clear payments). Implement Billing Agent and Dispute Agent with human approval workflows.</p>
                                <p><strong>Timeline:</strong> 4-6 months after Phase 1</p>
                                <p><strong>Success Metrics:</strong> 30% reduction in DSO, 40% reduction in dispute resolution time</p>
                            </div>
                        </div>
                        
                        <div class="phase">
                            <div class="phase-header">
                                <div class="phase-icon">🔄</div>
                                <h4>Phase 3: Fully Orchestrated System</h4>
                            </div>
                            <div class="phase-content">
                                <p>Implement the Orchestrator Agent to coordinate all specialized agents. Enable full automation for routine tasks with human oversight for exceptions and strategic decisions.</p>
                                <p><strong>Timeline:</strong> 6-8 months after Phase 2</p>
                                <p><strong>Success Metrics:</strong> 45% reduction in DSO, 75% reduction in manual AR processes, 15% improvement in cash flow</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="practical-implementation-note">
                    <h3>Technology Stack Recommendations</h3>
                    <p>Based on enterprise requirements for security, scale, and maintainability:</p>
                    
                    <div class="tech-stack-table">
                        <div class="tech-stack-row header-row">
                            <div class="tech-stack-cell">Component</div>
                            <div class="tech-stack-cell">Technology Options</div>
                            <div class="tech-stack-cell">Considerations</div>
                        </div>
                        <div class="tech-stack-row">
                            <div class="tech-stack-cell"><strong>Foundation Models</strong></div>
                            <div class="tech-stack-cell">Claude 3 Opus, GPT-4, local deployment options</div>
                            <div class="tech-stack-cell">Balance performance and cost; consider data residency requirements</div>
                        </div>
                        <div class="tech-stack-row">
                            <div class="tech-stack-cell"><strong>Vector Databases</strong></div>
                            <div class="tech-stack-cell">Pinecone, Weaviate, Postgres w/pgvector</div>
                            <div class="tech-stack-cell">Consider data volume, query patterns, and existing infrastructure</div>
                        </div>
                        <div class="tech-stack-row">
                            <div class="tech-stack-cell"><strong>Agent Framework</strong></div>
                            <div class="tech-stack-cell">LangChain, CrewAI, AutoGen, custom implementation</div>
                            <div class="tech-stack-cell">Evaluate tool calling capabilities, state management, and integration options</div>
                        </div>
                        <div class="tech-stack-row">
                            <div class="tech-stack-cell"><strong>Backend Services</strong></div>
                            <div class="tech-stack-cell">Python (FastAPI/Flask), Node.js, Go</div>
                            <div class="tech-stack-cell">Align with existing enterprise technology stack for maintainability</div>
                        </div>
                        <div class="tech-stack-row">
                            <div class="tech-stack-cell"><strong>Monitoring</strong></div>
                            <div class="tech-stack-cell">Prometheus, Grafana, ELK Stack, Application Insights</div>
                            <div class="tech-stack-cell">Include LLM-specific metrics like token usage, latency, and quality metrics</div>
                        </div>
                    </div>
                </div>

                <div class="roi-calculation">
                    <h3>ROI Analysis & Business Case</h3>
                    <p>Based on a mid-size enterprise with $50M annual revenue and $12M accounts receivable:</p>
                    
                    <div class="roi-metrics">
                        <div class="roi-metric">
                            <div class="roi-metric-value">$720K-$960K</div>
                            <div class="roi-metric-label">Annual Cash Flow Improvement</div>
                            <div class="roi-metric-calculation">From 15-20% reduction in DSO (6-8 days)</div>
                        </div>
                        <div class="roi-metric">
                            <div class="roi-metric-value">$300K-$450K</div>
                            <div class="roi-metric-label">Annual Labor Cost Savings</div>
                            <div class="roi-metric-calculation">From 60-70% reduction in manual AR tasks</div>
                        </div>
                        <div class="roi-metric">
                            <div class="roi-metric-value">$180K-$240K</div>
                            <div class="roi-metric-label">Bad Debt Reduction</div>
                            <div class="roi-metric-calculation">From improved collections rate (+5-8%)</div>
                        </div>
                        <div class="roi-metric">
                            <div class="roi-metric-value">$600K-$800K</div>
                            <div class="roi-metric-label">Total Implementation Cost</div>
                            <div class="roi-metric-calculation">Development, infrastructure, ongoing operations</div>
                        </div>
                        <div class="roi-metric">
                            <div class="roi-metric-value">7-10 months</div>
                            <div class="roi-metric-label">Payback Period</div>
                            <div class="roi-metric-calculation">Based on full implementation costs</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Simulation state
        const simulation = {
            isRunning: false,
            day: 1,
            month: 0,
            dso: 45,
            collection: 78,
            invoiceCount: 125,
            overdue: 850000,
            speed: 5,
            monthNames: [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ],
            dsoHistory: [45],
            collectionHistory: [78],
            invoiceHistory: [125],
            overdueHistory: [850000],
            intervalId: null,
            currentDate: new Date(2023, 0, 1), // Start at January 1, 2023
            invoiceData: [], // Detailed invoice information
            activityLog: [], // Detailed agent activity log
            clients: [
                { id: 1, name: "Acme Corporation", industry: "Manufacturing", paymentBehavior: "good", paymentDays: 35 },
                { id: 2, name: "Globex Inc.", industry: "Technology", paymentBehavior: "moderate", paymentDays: 42 },
                { id: 3, name: "Wayne Enterprises", industry: "Defense", paymentBehavior: "excellent", paymentDays: 28 },
                { id: 4, name: "Stark Industries", industry: "Technology", paymentBehavior: "moderate", paymentDays: 40 },
                { id: 5, name: "Umbrella Corporation", industry: "Pharmaceuticals", paymentBehavior: "poor", paymentDays: 55 },
                { id: 6, name: "Oscorp Industries", industry: "Research", paymentBehavior: "poor", paymentDays: 60 },
                { id: 7, name: "Cyberdyne Systems", industry: "Technology", paymentBehavior: "good", paymentDays: 38 },
                { id: 8, name: "Soylent Corp", industry: "Food", paymentBehavior: "moderate", paymentDays: 45 },
                { id: 9, name: "Weyland-Yutani", industry: "Defense", paymentBehavior: "excellent", paymentDays: 25 },
                { id: 10, name: "Tyrell Corporation", industry: "Technology", paymentBehavior: "moderate", paymentDays: 43 }
            ],
            agents: {
                orchestrator: {
                    icon: "🟡",
                    color: "#34495e",
                    title: "AR Orchestrator Agent",
                    description: "The AR Orchestrator Agent serves as the central coordinator for the entire accounts receivable process, using goal-oriented reasoning to prioritize tasks, delegate responsibilities, and ensure optimal cash flow.",
                    capabilities: [
                        "Prioritizes collections based on complex criteria like payment risk, client value, and cash flow needs",
                        "Identifies patterns across invoice aging to optimize collection strategies",
                        "Makes reasoned decisions about resource allocation based on changing business priorities",
                        "Evaluates performance metrics to recommend process improvements"
                    ],
                    collaborations: [
                        "Coordinates with Collections Agent to focus on high-priority accounts",
                        "Processes alerts from Risk Agent about compliance concerns",
                        "Uses insights from Reporting Agent to adjust overall AR strategy"
                    ]
                },
                billing: {
                    icon: "🟢",
                    color: "#2ecc71",
                    title: "Billing & Invoice Agent",
                    description: "The Billing & Invoice Agent automates the entire invoice generation process using natural language understanding to interpret contracts, extract relevant data, and create accurate invoices that comply with client-specific terms.",
                    capabilities: [
                        "Interprets contract language to determine correct billing treatments",
                        "Extracts billable data from multiple sources with contextual understanding",
                        "Validates invoices against business rules with reasoned exceptions",
                        "Analyzes past disputes to prevent recurring billing errors"
                    ],
                    collaborations: [
                        "Sends completed invoices to Collections Agent for follow-up",
                        "Receives dispute information from Dispute Agent to correct issues",
                        "Provides billing data to Reporting Agent for analysis"
                    ]
                },
                collections: {
                    icon: "🟠",
                    color: "#e67e22",
                    title: "Collections & Dunning Agent",
                    description: "The Collections & Dunning Agent optimizes the collections process by analyzing client payment histories, determining the most effective communication strategies, and proactively addressing potential payment delays.",
                    capabilities: [
                        "Crafts personalized dunning messages based on client communication preferences",
                        "Predicts payment likelihood using historical patterns",
                        "Determines optimal timing for follow-ups based on client behavior",
                        "Reasons through complex payment arrangements to maximize collections"
                    ],
                    collaborations: [
                        "Receives new invoices from Billing Agent to begin tracking",
                        "Works with Reconciliation Agent to confirm received payments",
                        "Alerts Risk Agent about problematic payment patterns"
                    ]
                },
                reconciliation: {
                    icon: "🔵",
                    color: "#3498db",
                    title: "Payment Reconciliation Agent",
                    description: "The Payment Reconciliation Agent matches incoming payments to outstanding invoices using probabilistic reasoning, handling complex scenarios like partial payments, missing references, and multi-invoice payments.",
                    capabilities: [
                        "Matches payments to invoices with incomplete reference information",
                        "Reasons through complex payment allocations across multiple invoices",
                        "Identifies patterns in payment behaviors to improve future matching",
                        "Makes informed decisions about how to allocate unspecified funds"
                    ],
                    collaborations: [
                        "Updates Collections Agent about received payments",
                        "Notifies Dispute Agent about payment discrepancies",
                        "Provides payment trend data to Reporting Agent"
                    ]
                },
                dispute: {
                    icon: "🟣",
                    color: "#9b59b6",
                    title: "Dispute & Deduction Management Agent",
                    description: "The Dispute & Deduction Management Agent handles invoice disputes by understanding client communications, retrieving relevant documentation, and proposing fair resolutions based on contract terms and business priorities.",
                    capabilities: [
                        "Comprehends dispute nature through natural language analysis",
                        "Retrieves and analyzes relevant contract clauses and documentation",
                        "Reasons through complex situations to determine appropriate resolutions",
                        "Learns from past dispute patterns to improve resolution approaches"
                    ],
                    collaborations: [
                        "Works with Billing Agent to correct invoice errors",
                        "Updates Collections Agent about dispute resolutions",
                        "Provides dispute pattern insights to Risk Agent"
                    ]
                },
                risk: {
                    icon: "🟠",
                    color: "#e74c3c",
                    title: "Risk & Compliance Monitoring Agent",
                    description: "The Risk & Compliance Monitoring Agent ensures adherence to financial regulations while identifying high-risk accounts through pattern recognition and historical analysis of payment behaviors.",
                    capabilities: [
                        "Identifies subtle signals of payment risk by connecting data points",
                        "Reasons through regulatory requirements to ensure compliant practices",
                        "Predicts potential compliance issues before they occur",
                        "Analyzes client payment histories to determine credit risk levels"
                    ],
                    collaborations: [
                        "Alerts Orchestrator Agent about high-risk accounts",
                        "Provides compliance guidelines to Billing Agent",
                        "Shares risk assessments with Collections Agent"
                    ]
                },
                reporting: {
                    icon: "🟡",
                    color: "#f1c40f",
                    title: "Reporting & Forecasting Agent",
                    description: "The Reporting & Forecasting Agent generates actionable insights by analyzing historical data, identifying trends, and producing accurate cash flow forecasts to guide AR strategy and improve collections.",
                    capabilities: [
                        "Interprets complex AR data to identify meaningful patterns",
                        "Generates natural language explanations of financial trends",
                        "Predicts future payment behaviors based on historical data",
                        "Recommends process changes based on holistic understanding"
                    ],
                    collaborations: [
                        "Provides strategic insights to Orchestrator Agent",
                        "Shares collection effectiveness data with Collections Agent",
                        "Uses risk data from Risk Agent to refine forecasts"
                    ]
                }
            }
        };
        
        // DOM elements
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const speedSlider = document.getElementById('speed-slider');
        const currentDay = document.getElementById('current-day');
        const currentMonth = document.getElementById('current-month');
        const dsoValue = document.getElementById('dso-value');
        const collectionValue = document.getElementById('collection-value');
        const invoiceValue = document.getElementById('invoice-value');
        const overdueValue = document.getElementById('overdue-value');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const agentCards = document.querySelectorAll('.agent-card');
        const agentNodes = document.querySelectorAll('.agent-node');
        const agentModal = document.getElementById('agent-modal');
        const modalClose = document.querySelector('.modal-close');
        const modalIcon = document.getElementById('modal-icon');
        const modalTitle = document.getElementById('modal-title');
        const modalDescription = document.getElementById('modal-description');
        const modalCapabilities = document.getElementById('modal-capabilities');
        const modalCollaborations = document.getElementById('modal-collaborations');
        
        // Activity log elements
        const activityFeed = document.getElementById('activity-feed');
        const agentFilter = document.getElementById('agent-filter');
        const activityTypeFilter = document.getElementById('activity-type-filter');
        
        // Invoice elements
        const invoiceTableBody = document.getElementById('invoice-table-body');
        const statusFilter = document.getElementById('status-filter');
        const invoiceSearch = document.getElementById('invoice-search');
        const totalInvoiceCount = document.getElementById('total-invoice-count');
        const totalOutstanding = document.getElementById('total-outstanding');
        const avgDaysToPayment = document.getElementById('avg-days-to-payment');
        
        // Chart setup
        const ctx = document.getElementById('metrics-chart').getContext('2d');
        let metricsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Month 1'],
                datasets: [
                    {
                        label: 'Days Sales Outstanding (DSO)',
                        data: [45],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Collection Effectiveness (%)',
                        data: [78],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'AR Performance Over Time with Agentic LLM Agents',
                        font: {
                            size: 16
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    },
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Days Sales Outstanding'
                        },
                        min: 20,
                        max: 50
                    },
                    y1: {
                        position: 'right',
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Collection Effectiveness (%)'
                        },
                        min: 70,
                        max: 100,
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        // Event listeners
        startBtn.addEventListener('click', startSimulation);
        pauseBtn.addEventListener('click', pauseSimulation);
        resetBtn.addEventListener('click', resetSimulation);
        speedSlider.addEventListener('input', updateSimulationSpeed);
        
        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                this.classList.add('active');
                document.getElementById(`${tabId}-content`).classList.add('active');
            });
        });
        
        // Agent card click event - show modal
        agentCards.forEach(card => {
            card.addEventListener('click', function() {
                const agentId = this.getAttribute('data-agent');
                showAgentModal(agentId);
            });
        });
        
        // Agent node click event - show modal
        agentNodes.forEach(node => {
            node.addEventListener('click', function() {
                const agentId = this.getAttribute('data-agent');
                showAgentModal(agentId);
            });
        });
        
        // Close modal
        modalClose.addEventListener('click', function() {
            agentModal.style.display = 'none';
        });
        
        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === agentModal) {
                agentModal.style.display = 'none';
            }
        });
        
        // Activity log filtering
        agentFilter.addEventListener('change', filterActivityLog);
        activityTypeFilter.addEventListener('change', filterActivityLog);
        
        // Invoice filtering
        statusFilter.addEventListener('change', filterInvoices);
        invoiceSearch.addEventListener('input', filterInvoices);
        
        // Initialize simulation
        initializeSimulation();
        
        // Initialize function
        function initializeSimulation() {
            // Generate initial invoices
            generateInitialInvoices();
            
            // Generate initial agent activities
            generateInitialActivities();
            
            // Update displays
            updateDisplays();
            
            // Update invoice table
            updateInvoiceTable();
            
            // Update activity feed
            updateActivityFeed();
        }
        
        // Show agent modal
        function showAgentModal(agentId) {
            const agent = simulation.agents[agentId];
            
            // Update modal content
            modalIcon.textContent = agent.icon;
            modalTitle.textContent = agent.title;
            modalDescription.textContent = agent.description;
            
            // Update capabilities list
            modalCapabilities.innerHTML = '';
            agent.capabilities.forEach(capability => {
                const li = document.createElement('li');
                li.className = 'capability-item';
                li.innerHTML = `
                    <span class="capability-icon">🧠</span>
                    <span>${capability}</span>
                `;
                modalCapabilities.appendChild(li);
            });
            
            // Update collaborations list
            modalCollaborations.innerHTML = '';
            agent.collaborations.forEach(collaboration => {
                const li = document.createElement('li');
                li.className = 'capability-item';
                li.innerHTML = `
                    <span class="capability-icon">🤝</span>
                    <span>${collaboration}</span>
                `;
                modalCollaborations.appendChild(li);
            });
            
            // Show modal
            agentModal.style.display = 'block';
        }
        
        // Simulation Functions
        function startSimulation() {
            if (!simulation.isRunning) {
                simulation.isRunning = true;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                // Start the simulation interval (runs every 500ms by default)
                const intervalSpeed = 500 / simulation.speed;
                simulation.intervalId = setInterval(advanceSimulation, intervalSpeed);
                
                // Start agent network animation
                startAgentNetworkAnimation();
                
                console.log("Simulation started");
            }
        }
        
        // Agent network animation
        function startAgentNetworkAnimation() {
            // Show thought bubbles periodically
            setInterval(showRandomThoughtBubble, 8000);
            
            // Activate communication lines periodically
            setInterval(activateRandomCommunicationLine, 3000);
            
            // Activate agents periodically
            setInterval(activateRandomAgent, 5000);
        }
        
        // Show a random thought bubble
        function showRandomThoughtBubble() {
            if (!simulation.isRunning) return;
            
            // Get all thought bubbles
            const thoughtBubbles = document.querySelectorAll('.thought-bubble');
            
            // Hide all thought bubbles first
            thoughtBubbles.forEach(bubble => {
                bubble.classList.remove('visible');
            });
            
            // Show a random thought bubble
            const randomIndex = Math.floor(Math.random() * thoughtBubbles.length);
            thoughtBubbles[randomIndex].classList.add('visible');
            
            // Hide it after 5 seconds
            setTimeout(() => {
                thoughtBubbles[randomIndex].classList.remove('visible');
            }, 5000);
        }
        
        // Activate a random communication line
        function activateRandomCommunicationLine() {
            if (!simulation.isRunning) return;
            
            // Get all communication lines
            const communicationLines = document.querySelectorAll('.communication-line');
            
            // Deactivate all lines first
            communicationLines.forEach(line => {
                line.classList.remove('active');
            });
            
            // Activate a random line
            const randomIndex = Math.floor(Math.random() * communicationLines.length);
            communicationLines[randomIndex].classList.add('active');
            
            // Deactivate it after 2 seconds
            setTimeout(() => {
                communicationLines[randomIndex].classList.remove('active');
            }, 2000);
        }
        
        // Activate a random agent
        function activateRandomAgent() {
            if (!simulation.isRunning) return;
            
            // Get all agent nodes
            const agentNodes = document.querySelectorAll('.agent-node');
            
            // Get current active agents
            const activeAgents = document.querySelectorAll('.agent-node.active');
            
            // Deactivate all active agents
            activeAgents.forEach(agent => {
                agent.classList.remove('active');
            });
            
            // Activate 1-2 random agents
            const count = Math.floor(Math.random() * 2) + 1;
            const activatedIndexes = [];
            
            for (let i = 0; i < count; i++) {
                // Generate a random index that hasn't been activated yet
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * agentNodes.length);
                } while (activatedIndexes.includes(randomIndex));
                
                activatedIndexes.push(randomIndex);
                agentNodes[randomIndex].classList.add('active');
                
                // Update status indicator
                const statusIndicator = agentNodes[randomIndex].querySelector('.agent-status-indicator');
                if (statusIndicator) {
                    statusIndicator.className = 'agent-status-indicator agent-status-processing';
                    statusIndicator.textContent = '⟳';
                    
                    // Reset after 4 seconds
                    setTimeout(() => {
                        agentNodes[randomIndex].classList.remove('active');
                        statusIndicator.className = 'agent-status-indicator agent-status-active';
                        statusIndicator.textContent = '✓';
                    }, 4000);
                }
            }
        }
        
        function pauseSimulation() {
            if (simulation.isRunning) {
                simulation.isRunning = false;
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                clearInterval(simulation.intervalId);
                console.log("Simulation paused");
            }
        }
        
        function resetSimulation() {
            // Stop the simulation if running
            if (simulation.isRunning) {
                pauseSimulation();
            }
            
            // Reset simulation state
            simulation.day = 1;
            simulation.month = 0;
            simulation.dso = 45;
            simulation.collection = 78;
            simulation.invoices = 125;
            simulation.overdue = 850000;
            simulation.dsoHistory = [45];
            simulation.collectionHistory = [78];
            simulation.invoiceHistory = [125];
            simulation.overdueHistory = [850000];
            
            // Update displays
            updateDisplays();
            
            // Reset chart
            updateChart();
            
            console.log("Simulation reset");
        }
        
        function updateSimulationSpeed() {
            simulation.speed = parseInt(speedSlider.value);
            
            // If simulation is running, update the interval
            if (simulation.isRunning) {
                clearInterval(simulation.intervalId);
                const intervalSpeed = 500 / simulation.speed;
                simulation.intervalId = setInterval(advanceSimulation, intervalSpeed);
            }
            
            console.log("Simulation speed updated:", simulation.speed);
        }
        
        function advanceSimulation() {
            // Advance day
            simulation.day++;
            
            // Advance current date
            simulation.currentDate.setDate(simulation.currentDate.getDate() + 1);
            
            // Generate daily events
            generateDailyEvents();
            
            // Check if month changed (every 30 days)
            if (simulation.day > 30) {
                simulation.day = 1;
                simulation.month = (simulation.month + 1) % 12;
                
                // Record monthly data points for the chart
                simulation.dsoHistory.push(simulation.dso);
                simulation.collectionHistory.push(simulation.collection);
                simulation.invoiceHistory.push(simulation.invoiceCount);
                simulation.overdueHistory.push(simulation.overdue);
                
                // Update the chart
                updateChart();
                
                // Generate monthly summary activity
                const monthlyActivity = {
                    time: formatDateTime(simulation.currentDate),
                    date: new Date(simulation.currentDate),
                    agent: "reporting",
                    agentIcon: simulation.agents.reporting.icon,
                    agentName: simulation.agents.reporting.title,
                    type: "analysis",
                    message: `Monthly performance summary: DSO reduced to ${Math.round(simulation.dso)} days, Collection Effectiveness improved to ${Math.round(simulation.collection)}%`,
                    reasoning: "Comprehensive analysis of monthly key performance indicators shows continued improvement in collection metrics. Agent learning from payment patterns has resulted in more effective collection strategies."
                };
                
                simulation.activityLog.unshift(monthlyActivity);
                
                // Update UI
                updateActivityFeed();
                
                console.log(`Month ${simulation.month + 1} started`);
            }
            
            // Update metrics based on AI agents' work
            updateMetrics();
            
            // Age all invoices by 1 day
            ageInvoices();
            
            // Update the displays
            updateDisplays();
            
            // Update invoice table
            updateInvoiceTable();
            
            // Stop after 6 months of simulation (to prevent running indefinitely)
            if (simulation.dsoHistory.length >= 7) {
                pauseSimulation();
                alert("Simulation completed - 6 month improvement cycle finished!");
                console.log("Simulation completed - 6 month improvement cycle finished");
            }
        }
        
        function updateMetrics() {
            // Calculate the progress factor (how far along we are in the simulation)
            const monthFactor = simulation.dsoHistory.length;
            const dayFactor = simulation.day / 30;
            const progressFactor = monthFactor + dayFactor;
            
            // Maximum improvements
            const maxDsoReduction = 15; // Max DSO reduction after 6 months
            const maxCollectionImprovement = 16; // From 78% to 94%
            
            // Add some randomness to make it more realistic
            const randomFactor = (Math.random() * 0.4) - 0.2; // Small random fluctuation between -0.2 and 0.2
            
            // Calculate DSO reduction (more effective as agents learn over time)
            // Each month, the improvement rate increases
            const baseReduction = Math.min(maxDsoReduction, progressFactor * 2.5);
            const dsoReduction = baseReduction + randomFactor;
            
            // Update DSO - won't go below 30 days
            simulation.dso = Math.max(30, 45 - dsoReduction);
            
            // Collection effectiveness improves (starts at 78%, max 94%)
            const collectionImprovement = Math.min(maxCollectionImprovement, progressFactor * 2.75);
            simulation.collection = Math.min(94, 78 + collectionImprovement);
            
            // Get current stats from invoice data
            const stats = calculateInvoiceStats();
            simulation.invoiceCount = stats.totalInvoices;
            simulation.overdue = stats.totalOutstandingAmount;
        }
        
        // Generate daily events like new invoices, payments, reminders, etc.
        function generateDailyEvents() {
            // Randomly decide which events happen today
            const events = [
                { type: "new_invoices", chance: 0.3 },
                { type: "payments", chance: 0.5 },
                { type: "overdue", chance: 0.4 },
                { type: "dispute", chance: 0.15 },
                { type: "reminders", chance: 0.4 },
                { type: "agent_insight", chance: 0.25 }
            ];
            
            // Process each possible event
            events.forEach(event => {
                if (Math.random() < event.chance) {
                    switch(event.type) {
                        case "new_invoices":
                            createNewInvoices();
                            break;
                        case "payments":
                            processPayments();
                            break;
                        case "overdue":
                            markOverdueInvoices();
                            break;
                        case "dispute":
                            createDispute();
                            break;
                        case "reminders":
                            sendReminders();
                            break;
                        case "agent_insight":
                            generateAgentInsight();
                            break;
                    }
                }
            });
        }
        
        // Create new invoices
        function createNewInvoices() {
            // Generate 1-3 new invoices
            const newInvoiceCount = Math.floor(Math.random() * 3) + 1;
            
            for (let i = 0; i < newInvoiceCount; i++) {
                // Select random client
                const client = simulation.clients[Math.floor(Math.random() * simulation.clients.length)];
                
                // Generate random amount
                const amount = Math.floor(Math.random() * 80000) + 20000; // Between 20K and 100K
                
                // Create invoice date (today)
                const invoiceDate = new Date(simulation.currentDate);
                
                // Due date is typically 30 days after invoice date
                const dueDate = new Date(invoiceDate);
                dueDate.setDate(dueDate.getDate() + 30);
                
                // Create unique invoice ID
                const invoiceId = `INV-${(simulation.currentDate.getFullYear()).toString().substring(2)}-${(simulation.invoiceData.length + 1).toString().padStart(5, '0')}`;
                
                // Status starts as draft
                const status = "draft";
                
                // Create invoice
                const newInvoice = {
                    id: invoiceId,
                    clientId: client.id,
                    clientName: client.name,
                    amount: amount,
                    date: invoiceDate,
                    dueDate: dueDate,
                    status: status,
                    age: 0, // New invoice
                    paymentDate: null,
                    daysToPayment: null,
                    notes: [],
                    history: [{
                        date: invoiceDate,
                        status: "created",
                        agent: "billing",
                        note: "Invoice created and validated by Billing Agent"
                    }]
                };
                
                // Add to invoice data
                simulation.invoiceData.push(newInvoice);
                
                // Generate activity
                const reasonings = [
                    "All line items were validated against contract rates using natural language understanding of agreement terms. Verified rate adjustments based on contract escalation clauses. Billing structure confirmed to client acceptance criteria.",
                    "Invoice validation process used contract NLP to ensure accurate application of rate cards. Historical analysis of client invoices ensured consistency with previous billing practices. Confirmed all appropriate discounts applied.",
                    "Contract terms extracted using semantic parsing to determine appropriate billing categories. Verified service dates against delivery documentation. All billable items confirmed against contractual scope definitions."
                ];
                
                // Add activity for invoice creation
                simulation.activityLog.unshift({
                    time: formatDateTime(invoiceDate),
                    date: invoiceDate,
                    agent: "billing",
                    agentIcon: simulation.agents.billing.icon,
                    agentName: simulation.agents.billing.title,
                    type: "action",
                    message: `Created new invoice ${invoiceId} for ${client.name} ($${formatNumber(amount)})`,
                    reasoning: reasonings[Math.floor(Math.random() * reasonings.length)]
                });
            }
            
            // Update activity feed
            updateActivityFeed();
        }
        
        // Process payments
        function processPayments() {
            // Get eligible invoices (sent or pending or overdue)
            const eligibleInvoices = simulation.invoiceData.filter(invoice => 
                invoice.status === 'sent' || invoice.status === 'pending' || invoice.status === 'overdue'
            );
            
            if (eligibleInvoices.length === 0) return; // No eligible invoices
            
            // Randomly select 1-3 invoices to be paid
            const paymentCount = Math.min(eligibleInvoices.length, Math.floor(Math.random() * 3) + 1);
            
            for (let i = 0; i < paymentCount; i++) {
                // Select a random invoice
                const randomIndex = Math.floor(Math.random() * eligibleInvoices.length);
                const invoice = eligibleInvoices[randomIndex];
                
                // Remove from eligible list so we don't select it again
                eligibleInvoices.splice(randomIndex, 1);
                if (eligibleInvoices.length === 0) break;
                
                // Get client and calculate payment probability based on behavior
                const client = simulation.clients.find(c => c.id === invoice.clientId);
                let paymentChance = 0.5; // Default
                
                if (client) {
                    switch(client.paymentBehavior) {
                        case "excellent":
                            paymentChance = 0.8;
                            break;
                        case "good":
                            paymentChance = 0.7;
                            break;
                        case "moderate":
                            paymentChance = 0.5;
                            break;
                        case "poor":
                            paymentChance = 0.3;
                            break;
                    }
                }
                
                // Agent effectiveness improves payment chance over time
                const progressFactor = simulation.dsoHistory.length + (simulation.day / 30);
                paymentChance += Math.min(0.3, progressFactor * 0.05); // Maximum 30% improvement
                
                // Check if payment happens
                if (Math.random() < paymentChance) {
                    // Mark invoice as paid
                    invoice.status = 'paid';
                    invoice.paymentDate = new Date(simulation.currentDate);
                    invoice.daysToPayment = Math.floor((invoice.paymentDate - invoice.date) / (1000 * 60 * 60 * 24));
                    
                    // Add to invoice history
                    invoice.history.push({
                        date: invoice.paymentDate,
                        status: "paid",
                        agent: "reconciliation",
                        note: "Payment received and matched to invoice"
                    });
                    
                    // Generate reasoning
                    const reasonings = [
                        "Payment matched using probabilistic reasoning against outstanding invoices. Partial payment amount was allocated based on aging and client's historical payment patterns. Client reference numbers were connected despite format inconsistencies.",
                        "Bank transaction description analyzed using NLP to extract implicit invoice references. Payment intent determined through historical pattern matching. Reconciliation confidence level: 98%.",
                        "Multi-invoice payment allocated through intelligent matching algorithm. Wire transfer details analyzed to establish payment intent. Applied fuzzy matching to connect client banking details with CRM records."
                    ];
                    
                    // Add activity
                    simulation.activityLog.unshift({
                        time: formatDateTime(simulation.currentDate),
                        date: new Date(simulation.currentDate),
                        agent: "reconciliation",
                        agentIcon: simulation.agents.reconciliation.icon,
                        agentName: simulation.agents.reconciliation.title,
                        type: "action",
                        message: `Received payment of $${formatNumber(invoice.amount)} for invoice ${invoice.id} from ${invoice.clientName}`,
                        reasoning: reasonings[Math.floor(Math.random() * reasonings.length)]
                    });
                }
            }
            
            // Update activity feed
            updateActivityFeed();
        }
        
        // Mark invoices as overdue
        function markOverdueInvoices() {
            // Get eligible invoices (pending with due date passed)
            const today = new Date(simulation.currentDate);
            const eligibleInvoices = simulation.invoiceData.filter(invoice => 
                invoice.status === 'pending' && invoice.dueDate < today
            );
            
            if (eligibleInvoices.length === 0) return; // No eligible invoices
            
            // Mark all eligible invoices as overdue
            eligibleInvoices.forEach(invoice => {
                invoice.status = 'overdue';
                
                // Add to invoice history
                invoice.history.push({
                    date: today,
                    status: "overdue",
                    agent: "collections",
                    note: "Invoice marked as overdue, collection process initiated"
                });
                
                // Generate reasoning
                const reasonings = [
                    "Invoice flagged as overdue based on due date analysis. Risk assessment performed using client payment history and current outstanding balance. Collection priority calculated based on amount and client relationship value.",
                    "Payment deadline monitoring system detected missed payment date. Historical analysis shows this client typically pays 15 days after due date. Assigned medium priority based on risk scoring algorithm.",
                    "Due date expiration triggered automated collection workflow. Client's payment risk score increased based on this and other outstanding invoices. Collection strategy customized based on client communication preferences."
                ];
                
                // Add activity
                simulation.activityLog.unshift({
                    time: formatDateTime(today),
                    date: today,
                    agent: "collections",
                    agentIcon: simulation.agents.collections.icon,
                    agentName: simulation.agents.collections.title,
                    type: "analysis",
                    message: `Marked invoice ${invoice.id} for ${invoice.clientName} as overdue (${Math.floor((today - invoice.dueDate) / (1000 * 60 * 60 * 24))} days past due)`,
                    reasoning: reasonings[Math.floor(Math.random() * reasonings.length)]
                });
            });
            
            // Update activity feed
            updateActivityFeed();
        }
        
        // Create a dispute
        function createDispute() {
            // Get eligible invoices (sent, pending, or overdue)
            const eligibleInvoices = simulation.invoiceData.filter(invoice => 
                invoice.status === 'sent' || invoice.status === 'pending' || invoice.status === 'overdue'
            );
            
            if (eligibleInvoices.length === 0) return; // No eligible invoices
            
            // Randomly select 1 invoice to be disputed
            const randomIndex = Math.floor(Math.random() * eligibleInvoices.length);
            const invoice = eligibleInvoices[randomIndex];
            
            // Mark as disputed
            invoice.status = 'disputed';
            
            // Add to invoice history
            invoice.history.push({
                date: new Date(simulation.currentDate),
                status: "disputed",
                agent: "dispute",
                note: "Client disputed invoice - investigating"
            });
            
            // Dispute types
            const disputeTypes = [
                "billing rate discrepancy",
                "service delivery question",
                "duplicate charge",
                "unauthorized services",
                "incorrect quantity"
            ];
            
            const disputeType = disputeTypes[Math.floor(Math.random() * disputeTypes.length)];
            
            // Generate reasoning
            const reasonings = [
                `Dispute email analyzed using natural language understanding. Issue classified as ${disputeType} with 94% confidence. Historical context of client communications analyzed to establish dispute pattern. Supporting documentation automatically requested from document management system.`,
                `Client communication sentiment analysis indicates moderate concern level. Categorized dispute as ${disputeType} through semantic parsing. Preliminary contract review shows potential ambiguity in service description that may have led to misunderstanding.`,
                `Email intent classification identified dispute regarding ${disputeType}. Automated retrieval of contract terms, service delivery documentation, and prior approvals initiated. Issue prioritization algorithm assigns high priority based on client relationship value.`
            ];
            
            // Add activity
            simulation.activityLog.unshift({
                time: formatDateTime(simulation.currentDate),
                date: new Date(simulation.currentDate),
                agent: "dispute",
                agentIcon: simulation.agents.dispute.icon,
                agentName: simulation.agents.dispute.title,
                type: "decision",
                message: `Processing dispute for invoice ${invoice.id} from ${invoice.clientName} regarding ${disputeType}`,
                reasoning: reasonings[Math.floor(Math.random() * reasonings.length)]
            });
            
            // Update activity feed
            updateActivityFeed();
        }
        
        // Send reminders
        function sendReminders() {
            // Get overdue invoices
            const overdueInvoices = simulation.invoiceData.filter(invoice => 
                invoice.status === 'overdue'
            );
            
            if (overdueInvoices.length === 0) return; // No overdue invoices
            
            // Randomly select 1-3 invoices to remind
            const reminderCount = Math.min(overdueInvoices.length, Math.floor(Math.random() * 3) + 1);
            
            for (let i = 0; i < reminderCount; i++) {
                // Select a random invoice
                const randomIndex = Math.floor(Math.random() * overdueInvoices.length);
                const invoice = overdueInvoices[randomIndex];
                
                // Remove from overdue list so we don't select it again
                overdueInvoices.splice(randomIndex, 1);
                if (overdueInvoices.length === 0) break;
                
                // Determine reminder number
                const reminderNumber = invoice.history.filter(h => 
                    h.status === "overdue" && h.note.includes("reminder")
                ).length + 1;
                
                // Add to invoice history
                invoice.history.push({
                    date: new Date(simulation.currentDate),
                    status: "overdue",
                    agent: "collections",
                    note: `Payment reminder #${reminderNumber} sent to client`
                });
                
                // Generate reasoning
                const reasonings = [
                    `Reminder timing optimized based on client's historical response patterns. Message content personalized using NLP analysis of client's previous communications. Tone and urgency calibrated to relationship value and payment delay length.`,
                    `Communication channel selected based on previous response rate analysis. Reminder contains personalized elements based on client relationship history. Payment urgency messaging adjusted for client's industry payment norms.`,
                    `Reminder strategy determined through behavioral analysis of client's past payment patterns. Message content optimized through A/B testing results across client portfolio. Escalation level determined by risk assessment algorithm.`
                ];
                
                // Add activity
                simulation.activityLog.unshift({
                    time: formatDateTime(simulation.currentDate),
                    date: new Date(simulation.currentDate),
                    agent: "collections",
                    agentIcon: simulation.agents.collections.icon,
                    agentName: simulation.agents.collections.title,
                    type: "communication",
                    message: `Sent payment reminder #${reminderNumber} for invoice ${invoice.id} to ${invoice.clientName} (${Math.floor((simulation.currentDate - invoice.dueDate) / (1000 * 60 * 60 * 24))} days overdue)`,
                    reasoning: reasonings[Math.floor(Math.random() * reasonings.length)]
                });
            }
            
            // Update activity feed
            updateActivityFeed();
        }
        
        // Generate agent insight
        function generateAgentInsight() {
            // Potential agents to provide insights
            const agents = ["orchestrator", "reporting", "risk"];
            const agent = agents[Math.floor(Math.random() * agents.length)];
            
            // Potential insight types
            const insightTypes = {
                orchestrator: [
                    {
                        type: "decision",
                        message: "Adjusted collections priority for technology sector clients based on payment pattern analysis",
                        reasoning: "Machine learning model identified emerging trend of delayed payments from technology sector. Rebalanced collections resources to focus on high-value invoices nearing 60-day mark. Recommended targeted approach based on client communication preferences."
                    },
                    {
                        type: "analysis",
                        message: "Identified opportunity to reduce DSO by optimizing invoice delivery timing",
                        reasoning: "Time-series analysis of payment patterns revealed correlation between invoice delivery day and payment speed. Clients receiving invoices early in week pay 2.3 days faster on average than those receiving invoices on Friday. Recommending schedule adjustment to improve cash flow."
                    }
                ],
                reporting: [
                    {
                        type: "analysis",
                        message: "Generated cash flow forecast showing 15% improvement in next 30 days",
                        reasoning: "Predictive model incorporating recent collection performance improvements, historical payment patterns, and seasonal factors indicates accelerating positive trend. Model accuracy validated against last 6 months of actual data with 92% precision."
                    },
                    {
                        type: "decision",
                        message: "Identified correlation between invoice format clarity and payment speed",
                        reasoning: "Comparative analysis of payment timing against invoice template variations shows statistically significant difference. Invoices using the revised template are paid 3.7 days faster on average. Recommending standardization on the more effective format."
                    }
                ],
                risk: [
                    {
                        type: "analysis",
                        message: "Detected early warning signs of payment issues with Oscorp Industries",
                        reasoning: "Pattern recognition algorithm identified subtle changes in payment behavior: progressively later payments, increased invoice queries, and partial payment attempts. These indicators match patterns observed in previous instances of client financial distress."
                    },
                    {
                        type: "decision",
                        message: "Performed compliance review of collection communications",
                        reasoning: "Natural language analysis of outgoing communications confirmed adherence to regulatory requirements and corporate policy guidelines. Sentiment analysis shows appropriate balance of firmness and relationship maintenance."
                    }
                ]
            };
            
            // Select random insight for the chosen agent
            const insights = insightTypes[agent];
            const insight = insights[Math.floor(Math.random() * insights.length)];
            
            // Add activity
            simulation.activityLog.unshift({
                time: formatDateTime(simulation.currentDate),
                date: new Date(simulation.currentDate),
                agent: agent,
                agentIcon: simulation.agents[agent].icon,
                agentName: simulation.agents[agent].title,
                type: insight.type,
                message: insight.message,
                reasoning: insight.reasoning
            });
            
            // Update activity feed
            updateActivityFeed();
        }
        
        // Age all invoices by one day
        function ageInvoices() {
            simulation.invoiceData.forEach(invoice => {
                invoice.age += 1;
            });
        }
        
        // Calculate invoice statistics
        function calculateInvoiceStats() {
            // Count invoices by status
            const statusCounts = {
                draft: 0,
                sent: 0,
                pending: 0,
                overdue: 0,
                disputed: 0,
                paid: 0
            };
            
            // Calculate totals
            let totalInvoices = simulation.invoiceData.length;
            let totalOutstandingAmount = 0;
            let totalPaidAmount = 0;
            
            simulation.invoiceData.forEach(invoice => {
                // Count by status
                statusCounts[invoice.status]++;
                
                // Add to outstanding amount if not paid
                if (invoice.status !== 'paid') {
                    totalOutstandingAmount += invoice.amount;
                } else {
                    totalPaidAmount += invoice.amount;
                }
            });
            
            return {
                totalInvoices,
                statusCounts,
                totalOutstandingAmount,
                totalPaidAmount
            };
        }
        
        function updateDisplays() {
            // Update time display
            currentDay.textContent = simulation.day;
            currentMonth.textContent = simulation.monthNames[simulation.month];
            
            // Update metrics
            dsoValue.textContent = Math.round(simulation.dso);
            collectionValue.textContent = Math.round(simulation.collection) + '%';
            invoiceValue.textContent = simulation.invoices;
            overdueValue.textContent = '$' + formatCurrency(simulation.overdue);
        }
        
        function updateChart() {
            // Update chart labels (months)
            const labels = [];
            for (let i = 0; i < simulation.dsoHistory.length; i++) {
                labels.push('Month ' + (i + 1));
            }
            
            metricsChart.data.labels = labels;
            metricsChart.data.datasets[0].data = simulation.dsoHistory;
            metricsChart.data.datasets[1].data = simulation.collectionHistory;
            metricsChart.update();
        }
        
        // Generate initial invoices
        function generateInitialInvoices() {
            simulation.invoiceData = [];
            const invoiceCount = 125; // Starting with 125 invoices
            const today = new Date(simulation.currentDate);
            
            // Create invoices with various dates and statuses
            for (let i = 1; i <= invoiceCount; i++) {
                const client = simulation.clients[Math.floor(Math.random() * simulation.clients.length)];
                const amount = Math.floor(Math.random() * 80000) + 20000; // Random amount between 20K and 100K
                
                // Random invoice date in the past (up to 90 days ago)
                const daysAgo = Math.floor(Math.random() * 90);
                const invoiceDate = new Date(today);
                invoiceDate.setDate(invoiceDate.getDate() - daysAgo);
                
                // Due date is typically 30 days after invoice date
                const dueDate = new Date(invoiceDate);
                dueDate.setDate(dueDate.getDate() + 30);
                
                // Calculate age in days
                const age = Math.floor((today - invoiceDate) / (1000 * 60 * 60 * 24));
                
                // Determine status based on dates and randomness
                let status;
                if (dueDate < today) {
                    // Invoice is past due date
                    if (Math.random() < 0.25) {
                        status = "disputed"; // 25% of overdue are disputed
                    } else if (Math.random() < 0.4) {
                        status = "paid"; // 40% of overdue are eventually paid
                    } else {
                        status = "overdue"; // Rest are still overdue
                    }
                } else {
                    // Invoice is not yet due
                    if (Math.random() < 0.3) {
                        status = "paid"; // 30% paid early
                    } else {
                        status = "pending"; // Rest are pending
                    }
                }
                
                // If invoice was recently created, some might still be in draft or sent status
                if (age < 5 && status === "pending" && Math.random() < 0.3) {
                    status = Math.random() < 0.5 ? "draft" : "sent";
                }
                
                // Create unique invoice ID
                const invoiceId = `INV-${(2023).toString().substring(2)}-${i.toString().padStart(5, '0')}`;
                
                // Generate payment date for paid invoices
                let paymentDate = null;
                if (status === "paid") {
                    // Payment usually happens around client's typical payment days
                    const estimatedPaymentDays = client.paymentDays + (Math.random() * 10 - 5); // +/- 5 days variance
                    paymentDate = new Date(invoiceDate);
                    paymentDate.setDate(paymentDate.getDate() + Math.round(estimatedPaymentDays));
                    
                    // But payment can't be in the future
                    if (paymentDate > today) {
                        paymentDate = new Date(today);
                    }
                }
                
                // Calculate days to payment for paid invoices
                const daysToPayment = paymentDate ? 
                    Math.floor((paymentDate - invoiceDate) / (1000 * 60 * 60 * 24)) : null;
                
                // Add invoice to the data
                simulation.invoiceData.push({
                    id: invoiceId,
                    clientId: client.id,
                    clientName: client.name,
                    amount: amount,
                    date: invoiceDate,
                    dueDate: dueDate,
                    status: status,
                    age: age,
                    paymentDate: paymentDate,
                    daysToPayment: daysToPayment,
                    notes: [],
                    history: [{
                        date: invoiceDate,
                        status: "created",
                        agent: "billing",
                        note: "Invoice created and validated by Billing Agent"
                    }]
                });
                
                // If sent or later status, add to history
                if (status !== "draft") {
                    const sentDate = new Date(invoiceDate);
                    sentDate.setDate(sentDate.getDate() + 1); // Usually sent 1 day after creation
                    
                    simulation.invoiceData[simulation.invoiceData.length - 1].history.push({
                        date: sentDate,
                        status: "sent",
                        agent: "billing",
                        note: "Invoice sent to client"
                    });
                }
                
                // If paid, add payment to history
                if (status === "paid" && paymentDate) {
                    simulation.invoiceData[simulation.invoiceData.length - 1].history.push({
                        date: paymentDate,
                        status: "paid",
                        agent: "reconciliation",
                        note: "Payment received and matched to invoice"
                    });
                }
                
                // If disputed, add dispute to history
                if (status === "disputed") {
                    const disputeDate = new Date(dueDate);
                    disputeDate.setDate(disputeDate.getDate() + Math.floor(Math.random() * 10)); // Dispute happens after due date
                    
                    simulation.invoiceData[simulation.invoiceData.length - 1].history.push({
                        date: disputeDate,
                        status: "disputed",
                        agent: "dispute",
                        note: "Client disputed invoice - investigating"
                    });
                }
                
                // If overdue, add overdue notice to history
                if (status === "overdue") {
                    const overdueDate = new Date(dueDate);
                    overdueDate.setDate(overdueDate.getDate() + 1); // Overdue happens after due date
                    
                    simulation.invoiceData[simulation.invoiceData.length - 1].history.push({
                        date: overdueDate,
                        status: "overdue",
                        agent: "collections",
                        note: "Invoice marked as overdue, collection process initiated"
                    });
                    
                    // Add reminder attempts
                    const reminder1Date = new Date(overdueDate);
                    reminder1Date.setDate(reminder1Date.getDate() + 7); // First reminder 7 days after overdue
                    
                    if (reminder1Date < today) {
                        simulation.invoiceData[simulation.invoiceData.length - 1].history.push({
                            date: reminder1Date,
                            status: "overdue",
                            agent: "collections",
                            note: "First payment reminder sent to client"
                        });
                        
                        // Sometimes add a second reminder
                        if (Math.random() < 0.7) {
                            const reminder2Date = new Date(reminder1Date);
                            reminder2Date.setDate(reminder2Date.getDate() + 7); // Second reminder 7 days after first
                            
                            if (reminder2Date < today) {
                                simulation.invoiceData[simulation.invoiceData.length - 1].history.push({
                                    date: reminder2Date,
                                    status: "overdue",
                                    agent: "collections",
                                    note: "Second payment reminder sent to client"
                                });
                            }
                        }
                    }
                }
            }
            
            // Update invoice count
            updateInvoiceStats();
        }
        
        // Generate initial agent activities
        function generateInitialActivities() {
            // Clear activity log
            simulation.activityLog = [];
            
            // Generate initial activities based on invoice data
            simulation.invoiceData.forEach(invoice => {
                // For each invoice history item, generate an activity
                invoice.history.forEach(historyItem => {
                    let activityType;
                    let reasoning = "";
                    
                    // Determine activity type and reasoning based on the action
                    switch(historyItem.status) {
                        case "created":
                            activityType = "action";
                            reasoning = "Invoice validation complete. All line items matched contracted rates and terms. Client agreement verified for billing compliance.";
                            break;
                        case "sent":
                            activityType = "communication";
                            reasoning = "Invoice delivery timing optimized based on client's accounts payable processing schedule. Delivery method selected based on client preferences.";
                            break;
                        case "paid":
                            activityType = "action";
                            reasoning = "Payment successfully matched to invoice using reference data and amount pattern recognition. Client payment behavior consistent with historical patterns.";
                            break;
                        case "disputed":
                            activityType = "decision";
                            reasoning = "Dispute categorized as billing question based on email content analysis. Historical context shows similar questions on previous invoices. Priority set to high based on client relationship value.";
                            break;
                        case "overdue":
                            activityType = "analysis";
                            if (historyItem.note.includes("reminder")) {
                                activityType = "communication";
                                reasoning = "Reminder timing and content personalized based on client's past response patterns. Tone adjusted to maintain positive relationship while emphasizing payment urgency.";
                            } else {
                                reasoning = "Invoice flagged as overdue based on due date analysis. Risk assessment performed using client payment history and current outstanding balance.";
                            }
                            break;
                    }
                    
                    // Generate activity log entry
                    simulation.activityLog.push({
                        time: formatDateTime(historyItem.date),
                        date: historyItem.date,
                        agent: historyItem.agent,
                        agentIcon: simulation.agents[historyItem.agent].icon,
                        agentName: simulation.agents[historyItem.agent].title,
                        type: activityType,
                        message: `${historyItem.note} for invoice ${invoice.id} (${invoice.clientName})`,
                        reasoning: reasoning
                    });
                });
            });
            
            // Add some orchestrator activities
            const orchestratorActivities = [
                {
                    type: "decision",
                    message: "Prioritized collections for high-value overdue accounts based on cash flow forecasting",
                    reasoning: "Analysis of current cash position versus projected expenses indicates a need to focus on collecting larger invoices. Prioritization algorithm weighted factors including invoice amount, client payment history, and age of debt."
                },
                {
                    type: "analysis",
                    message: "Analyzed current DSO metrics and identified improvement opportunities in collections process",
                    reasoning: "Pattern analysis revealed certain client segments consistently paying 5-7 days late. Identified correlation between payment timing and invoice delivery method that can be optimized for faster payment."
                },
                {
                    type: "communication",
                    message: "Escalated high-risk accounts to management for review",
                    reasoning: "Risk scoring algorithm identified 3 accounts with unusual payment pattern changes compared to 12-month baseline. Potential financial distress indicators triggered escalation protocol."
                }
            ];
            
            // Add reporting agent activities
            const reportingActivities = [
                {
                    type: "analysis",
                    message: "Generated AR aging analysis with cash flow projections for next 60 days",
                    reasoning: "Probabilistic model applied to outstanding invoices using historical payment patterns and seasonal adjustments. Model confidence level: 87% based on 24-month payment history."
                },
                {
                    type: "decision",
                    message: "Recommended adjustment to collections strategy based on industry payment trend analysis",
                    reasoning: "Data shows technology sector clients responding better to early-morning communications while manufacturing clients prefer end-of-day. Recommendation adjusts timing to optimize response rates."
                }
            ];
            
            // Add risk agent activities
            const riskActivities = [
                {
                    type: "analysis",
                    message: "Performed compliance audit on invoice terms and payment applications",
                    reasoning: "Systematic review of all payment terms against master service agreements found no compliance issues. All discount applications validated against approval workflows."
                },
                {
                    type: "decision",
                    message: "Flagged potential payment risk with Oscorp Industries based on payment pattern changes",
                    reasoning: "Statistical anomaly detection identified significant deviation from established payment patterns. Last 3 payments were progressively later by 5-7 days each cycle, indicating potential cash flow constraints."
                }
            ];
            
            // Generate dates for these activities spread over past 7 days
            const today = new Date(simulation.currentDate);
            const pastDays = 7;
            const baseDate = new Date(today);
            baseDate.setDate(baseDate.getDate() - pastDays);
            
            // Add orchestrator activities
            orchestratorActivities.forEach((activity, index) => {
                const activityDate = new Date(baseDate);
                activityDate.setDate(activityDate.getDate() + Math.floor(index * (pastDays/orchestratorActivities.length)));
                activityDate.setHours(9 + Math.floor(Math.random() * 8)); // Between 9 AM and 5 PM
                
                simulation.activityLog.push({
                    time: formatDateTime(activityDate),
                    date: activityDate,
                    agent: "orchestrator",
                    agentIcon: simulation.agents.orchestrator.icon,
                    agentName: simulation.agents.orchestrator.title,
                    type: activity.type,
                    message: activity.message,
                    reasoning: activity.reasoning
                });
            });
            
            // Add reporting activities
            reportingActivities.forEach((activity, index) => {
                const activityDate = new Date(baseDate);
                activityDate.setDate(activityDate.getDate() + Math.floor(index * (pastDays/reportingActivities.length)) + 1);
                activityDate.setHours(10 + Math.floor(Math.random() * 6)); // Between 10 AM and 4 PM
                
                simulation.activityLog.push({
                    time: formatDateTime(activityDate),
                    date: activityDate,
                    agent: "reporting",
                    agentIcon: simulation.agents.reporting.icon,
                    agentName: simulation.agents.reporting.title,
                    type: activity.type,
                    message: activity.message,
                    reasoning: activity.reasoning
                });
            });
            
            // Add risk activities
            riskActivities.forEach((activity, index) => {
                const activityDate = new Date(baseDate);
                activityDate.setDate(activityDate.getDate() + Math.floor(index * (pastDays/riskActivities.length)) + 2);
                activityDate.setHours(11 + Math.floor(Math.random() * 5)); // Between 11 AM and 4 PM
                
                simulation.activityLog.push({
                    time: formatDateTime(activityDate),
                    date: activityDate,
                    agent: "risk",
                    agentIcon: simulation.agents.risk.icon,
                    agentName: simulation.agents.risk.title,
                    type: activity.type,
                    message: activity.message,
                    reasoning: activity.reasoning
                });
            });
            
            // Sort activities by date (newest first)
            simulation.activityLog.sort((a, b) => b.date - a.date);
        }
        
        // Update invoice table based on filters
        function updateInvoiceTable() {
            const statusFilterValue = statusFilter.value;
            const searchValue = invoiceSearch.value.toLowerCase();
            
            // Clear the table
            invoiceTableBody.innerHTML = '';
            
            // Filter invoices
            const filteredInvoices = simulation.invoiceData.filter(invoice => {
                // Filter by status
                if (statusFilterValue !== 'all' && invoice.status !== statusFilterValue) {
                    return false;
                }
                
                // Filter by search
                if (searchValue && !(
                    invoice.id.toLowerCase().includes(searchValue) ||
                    invoice.clientName.toLowerCase().includes(searchValue)
                )) {
                    return false;
                }
                
                return true;
            });
            
            // Sort by date (newest first)
            filteredInvoices.sort((a, b) => b.date - a.date);
            
            // Add invoices to table
            filteredInvoices.forEach(invoice => {
                const row = document.createElement('tr');
                
                // Format dates
                const issueDate = formatDate(invoice.date);
                const dueDate = formatDate(invoice.dueDate);
                
                // Get status badge class
                let statusBadgeClass = `status-${invoice.status}`;
                
                row.innerHTML = `
                    <td>${invoice.id}</td>
                    <td>${invoice.clientName}</td>
                    <td>$${formatNumber(invoice.amount)}</td>
                    <td>${issueDate}</td>
                    <td>${dueDate}</td>
                    <td><span class="status-badge ${statusBadgeClass}">${invoice.status}</span></td>
                    <td>${invoice.age}</td>
                    <td>
                        <div class="invoice-actions">
                            <button class="action-btn view-invoice" data-id="${invoice.id}">View</button>
                            <button class="action-btn view-history" data-id="${invoice.id}">History</button>
                        </div>
                    </td>
                `;
                
                invoiceTableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-invoice').forEach(button => {
                button.addEventListener('click', function() {
                    const invoiceId = this.getAttribute('data-id');
                    showInvoiceDetailsModal(invoiceId);
                });
            });
            
            document.querySelectorAll('.view-history').forEach(button => {
                button.addEventListener('click', function() {
                    const invoiceId = this.getAttribute('data-id');
                    showInvoiceHistoryModal(invoiceId);
                });
            });
            
            // Update invoice stats
            updateInvoiceStats();
        }
        
        // Filter invoices based on user selections
        function filterInvoices() {
            updateInvoiceTable();
        }
        
        // Update invoice statistics
        function updateInvoiceStats() {
            // Calculate total invoices
            const totalInvoices = simulation.invoiceData.length;
            
            // Calculate total outstanding amount
            const outstandingInvoices = simulation.invoiceData.filter(
                invoice => invoice.status === 'draft' || invoice.status === 'sent' || 
                           invoice.status === 'pending' || invoice.status === 'overdue' || 
                           invoice.status === 'disputed'
            );
            
            const totalOutstandingAmount = outstandingInvoices.reduce(
                (sum, invoice) => sum + invoice.amount, 0
            );
            
            // Calculate average days to payment
            const paidInvoices = simulation.invoiceData.filter(invoice => invoice.status === 'paid');
            const totalDaysToPayment = paidInvoices.reduce(
                (sum, invoice) => sum + (invoice.daysToPayment || 0), 0
            );
            
            const avgDays = paidInvoices.length > 0 ? 
                Math.round(totalDaysToPayment / paidInvoices.length) : 0;
            
            // Update the UI
            totalInvoiceCount.textContent = totalInvoices;
            totalOutstanding.textContent = `$${formatNumber(totalOutstandingAmount)}`;
            avgDaysToPayment.textContent = avgDays;
        }
        
        // Update activity feed based on filters
        function updateActivityFeed() {
            const agentFilterValue = agentFilter.value;
            const typeFilterValue = activityTypeFilter.value;
            
            // Clear the feed
            activityFeed.innerHTML = '';
            
            // Filter activities
            const filteredActivities = simulation.activityLog.filter(activity => {
                // Filter by agent
                if (agentFilterValue !== 'all' && activity.agent !== agentFilterValue) {
                    return false;
                }
                
                // Filter by type
                if (typeFilterValue !== 'all' && activity.type !== typeFilterValue) {
                    return false;
                }
                
                return true;
            });
            
            // Add activities to feed
            filteredActivities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                
                // Set border color based on agent
                const agentColor = simulation.agents[activity.agent].color;
                activityItem.style.borderLeftColor = agentColor;
                
                // Get activity type class
                const typeClass = `activity-type-${activity.type}`;
                
                // Generate detailed thought process based on activity type and agent
                let thoughtProcess = generateThoughtProcess(activity);
                
                // Generate agent connections based on activity
                let connections = generateAgentConnections(activity);
                
                activityItem.innerHTML = `
                    <div class="activity-header">
                        <div class="activity-agent">
                            <span class="activity-agent-icon">${activity.agentIcon}</span>
                            ${activity.agentName}
                        </div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                    <span class="activity-type ${typeClass}">${activity.type}</span>
                    <div class="activity-message">${activity.message}</div>
                    <div class="activity-reasoning">${activity.reasoning}</div>
                    <div class="activity-thought-bubble">${thoughtProcess}</div>
                    <div class="activity-connections">
                        <div class="activity-connections-title">Agent Collaboration:</div>
                        ${connections}
                    </div>
                `;
                
                activityFeed.appendChild(activityItem);
            });
        }
        
        // Generate detailed thought process for an activity
        function generateThoughtProcess(activity) {
            // Different thought processes based on activity type
            const thoughtProcesses = {
                decision: {
                    orchestrator: [
                        "1. Analyzed current AR metrics (DSO, CEI, outstanding amounts)",
                        "2. Evaluated resource allocation across agent network",
                        "3. Identified opportunity to optimize collection efforts based on aging",
                        "4. Applied decision matrix to balance immediate cash flow vs client relationships",
                        "5. Determined optimal resource distribution to maximize collection outcome"
                    ],
                    reporting: [
                        "1. Analyzed historical payment patterns across client segments",
                        "2. Identified correlations between invoice characteristics and payment timing",
                        "3. Applied statistical models to quantify impact factors",
                        "4. Generated confidence intervals for projected outcomes",
                        "5. Formulated actionable recommendations with expected impact"
                    ],
                    dispute: [
                        "1. Analyzed dispute communication content using NLP",
                        "2. Classified dispute type and severity",
                        "3. Retrieved relevant contract terms and prior communications",
                        "4. Evaluated financial impact of potential resolutions",
                        "5. Determined optimal response strategy balancing client satisfaction and financial outcome"
                    ]
                },
                action: {
                    billing: [
                        "1. Retrieved contract and service delivery data",
                        "2. Applied contract terms to billable items",
                        "3. Validated rates against master agreement",
                        "4. Checked for potential dispute triggers based on historical patterns",
                        "5. Generated compliant invoice with all required reference information"
                    ],
                    collections: [
                        "1. Analyzed client payment history and communication preferences",
                        "2. Selected optimal communication channel and timing",
                        "3. Generated personalized message with relevant invoice details",
                        "4. Applied appropriate urgency level based on aging and client value",
                        "5. Scheduled follow-up based on expected response patterns"
                    ],
                    reconciliation: [
                        "1. Parsed incoming payment details and reference information",
                        "2. Generated matching candidates from outstanding invoices",
                        "3. Applied probabilistic matching algorithms with confidence scoring",
                        "4. Determined optimal allocation for partial or multi-invoice payments",
                        "5. Recorded payment application with complete audit trail"
                    ]
                },
                communication: {
                    collections: [
                        "1. Analyzed previous client response patterns to communications",
                        "2. Selected messaging tone based on relationship value and payment history",
                        "3. Personalized content with specific invoice details and payment options",
                        "4. Optimized delivery timing based on client accounts payable patterns",
                        "5. Prepared response handling for common payment delay reasons"
                    ],
                    orchestrator: [
                        "1. Analyzed alert severity and business impact",
                        "2. Determined appropriate escalation level",
                        "3. Compiled relevant context information and history",
                        "4. Generated executive summary with key action points",
                        "5. Initiated appropriate notification protocols"
                    ]
                },
                analysis: {
                    reporting: [
                        "1. Aggregated payment performance data across client segments",
                        "2. Applied time-series analysis to identify trends and anomalies",
                        "3. Performed statistical testing to validate pattern significance",
                        "4. Generated predictive models with confidence intervals",
                        "5. Translated analytical findings into business impact projections"
                    ],
                    risk: [
                        "1. Monitored for deviations from established payment patterns",
                        "2. Applied anomaly detection algorithms to identify significant changes",
                        "3. Correlated pattern changes with external economic indicators",
                        "4. Calculated probability of payment default based on observed signals",
                        "5. Quantified potential financial impact of identified risks"
                    ],
                    collections: [
                        "1. Monitored invoice aging across customer portfolio",
                        "2. Identified invoices crossing critical aging thresholds",
                        "3. Applied risk scoring based on aging and client payment history",
                        "4. Calculated impact on DSO and cash flow projections",
                        "5. Prioritized collection efforts based on business impact"
                    ]
                }
            };
            
            // Default thought process if specific one not found
            const defaultThoughtProcess = [
                "1. Analyzed relevant data and context",
                "2. Applied domain-specific algorithms and heuristics",
                "3. Generated potential actions and outcomes",
                "4. Evaluated options against objective criteria",
                "5. Selected optimal course of action with highest expected value"
            ];
            
            // Get specific thought process or use default
            const typeThoughts = thoughtProcesses[activity.type] || {};
            const agentThoughts = typeThoughts[activity.agent] || defaultThoughtProcess;
            
            return agentThoughts.join('<br>');
        }
        
        // Generate agent connections for an activity
        function generateAgentConnections(activity) {
            // Define possible connections based on agent and activity type
            const connectionMap = {
                orchestrator: {
                    decision: ['collections', 'risk', 'reporting'],
                    analysis: ['reporting', 'collections', 'risk'],
                    communication: ['collections', 'risk']
                },
                billing: {
                    action: ['orchestrator', 'collections'],
                    decision: ['orchestrator', 'dispute']
                },
                collections: {
                    action: ['orchestrator', 'reconciliation'],
                    communication: ['orchestrator', 'billing'],
                    analysis: ['reporting', 'risk']
                },
                reconciliation: {
                    action: ['collections', 'orchestrator'],
                    analysis: ['reporting', 'risk']
                },
                dispute: {
                    decision: ['orchestrator', 'billing'],
                    communication: ['billing', 'collections']
                },
                risk: {
                    analysis: ['orchestrator', 'reporting'],
                    decision: ['orchestrator', 'collections']
                },
                reporting: {
                    analysis: ['orchestrator', 'collections'],
                    decision: ['orchestrator', 'risk']
                }
            };
            
            // Get connections for this activity or default to empty array
            const agentConnections = connectionMap[activity.agent] || {};
            const connections = agentConnections[activity.type] || [];
            
            // Generate connection items
            if (connections.length === 0) {
                return '<div class="connection-item"><span class="connection-icon">🔄</span>Independent operation</div>';
            }
            
            // Generate connection HTML
            let connectionsHtml = '';
            connections.forEach(connectedAgent => {
                const agentInfo = simulation.agents[connectedAgent];
                connectionsHtml += `
                    <div class="connection-item">
                        <span class="connection-icon">${agentInfo.icon}</span>
                        Collaborating with ${agentInfo.title}
                    </div>
                `;
            });
            
            return connectionsHtml;
        }
        
        // Filter activity log based on user selections
        function filterActivityLog() {
            updateActivityFeed();
        }
        
        // Helper function to format currency
        function formatCurrency(value) {
            if (value >= 1000000) {
                return (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return (value / 1000).toFixed(0) + 'K';
            }
            return value.toString();
        }
        
        // Helper function to format numbers with commas
        function formatNumber(value) {
            return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        // Helper function to format dates
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        // Helper function to format date and time
        function formatDateTime(date) {
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Show invoice details modal
        function showInvoiceDetailsModal(invoiceId) {
            // Find the invoice
            const invoice = simulation.invoiceData.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            // Get modal elements
            const modal = document.getElementById('invoice-details-modal');
            const modalTitle = document.getElementById('invoice-details-title');
            const modalContent = document.getElementById('invoice-details-content');
            const modalProcessing = document.getElementById('invoice-agent-processing');
            const modalReasoning = document.getElementById('invoice-agent-reasoning');
            
            // Set modal title
            modalTitle.textContent = `Invoice ${invoice.id}`;
            
            // Generate invoice details
            const issueDate = formatDate(invoice.date);
            const dueDate = formatDate(invoice.dueDate);
            const paymentDate = invoice.paymentDate ? formatDate(invoice.paymentDate) : 'Not paid';
            
            // Get status badge class
            let statusBadgeClass = `status-${invoice.status}`;
            
            // Generate invoice details HTML
            modalContent.innerHTML = `
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Client:</span>
                    <span class="invoice-detail-value">${invoice.clientName}</span>
                </div>
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Amount:</span>
                    <span class="invoice-detail-value">$${formatNumber(invoice.amount)}</span>
                </div>
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Issue Date:</span>
                    <span class="invoice-detail-value">${issueDate}</span>
                </div>
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Due Date:</span>
                    <span class="invoice-detail-value">${dueDate}</span>
                </div>
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Age:</span>
                    <span class="invoice-detail-value">${invoice.age} days</span>
                </div>
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Status:</span>
                    <span class="invoice-status-large ${statusBadgeClass}">${invoice.status}</span>
                </div>
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Payment Date:</span>
                    <span class="invoice-detail-value">${paymentDate}</span>
                </div>
                <div class="invoice-detail-item">
                    <span class="invoice-detail-label">Days to Payment:</span>
                    <span class="invoice-detail-value">${invoice.daysToPayment || 'Not applicable'}</span>
                </div>
            `;
            
            // Generate agent processing content
            let processingContent = '';
            
            // Different processing steps based on invoice status
            switch(invoice.status) {
                case 'draft':
                    processingContent = `
                        <p><strong>Billing Agent:</strong> Invoice is being prepared and validated</p>
                        <ul>
                            <li>✓ Contract terms extracted and applied to line items</li>
                            <li>✓ Service rates validated against price agreement</li>
                            <li>✓ Quantity and service period validated</li>
                            <li>✓ Client billing preferences applied</li>
                            <li>⟳ Final validation in progress...</li>
                        </ul>
                    `;
                    break;
                case 'sent':
                    processingContent = `
                        <p><strong>Billing Agent:</strong> Invoice has been sent to client</p>
                        <ul>
                            <li>✓ Invoice generated according to contract terms</li>
                            <li>✓ Client billing preferences applied</li>
                            <li>✓ Invoice delivered via preferred channel</li>
                            <li>✓ Collections Agent notified for tracking</li>
                        </ul>
                        <p><strong>Collections Agent:</strong> Monitoring for payment</p>
                        <ul>
                            <li>✓ Payment reminder schedule created</li>
                            <li>✓ Expected payment date calculated: ${formatDate(new Date(invoice.dueDate))}</li>
                        </ul>
                    `;
                    break;
                case 'pending':
                    processingContent = `
                        <p><strong>Collections Agent:</strong> Actively monitoring for payment</p>
                        <ul>
                            <li>✓ Invoice delivery confirmed</li>
                            <li>✓ Estimated payment probability: ${Math.round(60 + Math.random() * 20)}%</li>
                            <li>✓ Reminder scheduled if not paid by ${formatDate(new Date(invoice.dueDate.getTime() - 7 * 24 * 60 * 60 * 1000))}</li>
                            <li>✓ Payment scan scheduled daily</li>
                        </ul>
                    `;
                    break;
                case 'overdue':
                    processingContent = `
                        <p><strong>Collections Agent:</strong> Invoice is overdue - collection actions in progress</p>
                        <ul>
                            <li>✓ Overdue notice generated</li>
                            <li>✓ Payment reminders sent: ${invoice.history.filter(h => h.note.includes('reminder')).length}</li>
                            <li>✓ Risk level assessed: Medium</li>
                            <li>✓ Collection strategy optimized based on client relationship value</li>
                            <li>⟳ Next action scheduled: ${formatDate(new Date(simulation.currentDate.getTime() + 2 * 24 * 60 * 60 * 1000))}</li>
                        </ul>
                        <p><strong>Risk Agent:</strong> Monitoring payment pattern</p>
                        <ul>
                            <li>✓ Client payment behavior analyzed</li>
                            <li>✓ Risk factor calculated: ${Math.round(30 + Math.random() * 40)}</li>
                        </ul>
                    `;
                    break;
                case 'disputed':
                    processingContent = `
                        <p><strong>Dispute Agent:</strong> Actively resolving dispute</p>
                        <ul>
                            <li>✓ Dispute categorized: Billing discrepancy</li>
                            <li>✓ Contract terms retrieved and analyzed</li>
                            <li>✓ Service delivery documentation retrieved</li>
                            <li>✓ Dispute resolution priority: High</li>
                            <li>⟳ Resolution in progress</li>
                        </ul>
                        <p><strong>Billing Agent:</strong> Collaborating on dispute resolution</p>
                        <ul>
                            <li>✓ Original invoice documentation provided</li>
                            <li>✓ Rate card validation performed</li>
                        </ul>
                    `;
                    break;
                case 'paid':
                    processingContent = `
                        <p><strong>Reconciliation Agent:</strong> Payment successfully processed</p>
                        <ul>
                            <li>✓ Payment received and matched</li>
                            <li>✓ Amount verified: $${formatNumber(invoice.amount)}</li>
                            <li>✓ Payment date recorded: ${formatDate(invoice.paymentDate)}</li>
                            <li>✓ Days to payment: ${invoice.daysToPayment}</li>
                        </ul>
                        <p><strong>Reporting Agent:</strong> Payment metrics updated</p>
                        <ul>
                            <li>✓ DSO impact calculated</li>
                            <li>✓ Payment pattern recorded for future analysis</li>
                        </ul>
                    `;
                    break;
            }
            
            modalProcessing.innerHTML = processingContent;
            
            // Generate agent reasoning
            let reasoningContent = '';
            
            // Different reasoning based on invoice status
            switch(invoice.status) {
                case 'draft':
                    reasoningContent = `
                        <p>The Billing Agent is applying natural language understanding to extract and interpret complex contract terms. This includes:</p>
                        <ul>
                            <li>Analyzing service descriptions to match with appropriate rate cards</li>
                            <li>Applying contextual understanding to determine correct billing categories</li>
                            <li>Determining if volume discounts or tiered pricing should apply based on historical usage</li>
                            <li>Validating that all charges comply with master service agreement terms</li>
                        </ul>
                        <p>The agent recognizes potential invoice disputes by comparing to historical billing patterns and is preemptively validating potential question areas.</p>
                    `;
                    break;
                case 'sent':
                    reasoningContent = `
                        <p>The Billing Agent optimized invoice delivery timing based on analysis of the client's accounts payable processing schedule. The agent determined that invoices sent on ${['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'][Math.floor(Math.random() * 5)]} have the highest probability of prompt processing.</p>
                        <p>The Collections Agent has analyzed this client's payment history and determined their typical payment timeline is ${Math.round(invoice.dueDate.getDate() - invoice.date.getDate() - 5)} to ${Math.round(invoice.dueDate.getDate() - invoice.date.getDate() + 5)} days from receipt. This informs the optimal reminder schedule and payment probability calculations.</p>
                    `;
                    break;
                case 'pending':
                    reasoningContent = `
                        <p>The Collections Agent is monitoring this invoice with a customized approach based on client relationship analysis. Key factors in the monitoring strategy include:</p>
                        <ul>
                            <li>This client typically pays ${Math.random() < 0.5 ? 'early' : 'close to due date'} based on 12-month payment history</li>
                            <li>Client has a ${Math.random() < 0.3 ? 'low' : 'moderate'} query rate on invoices (${Math.round(Math.random() * 15)}% of invoices historically questioned)</li>
                            <li>Optimized communication strategy uses ${Math.random() < 0.5 ? 'email' : 'client portal'} as primary channel based on response rate analysis</li>
                        </ul>
                        <p>The agent adapts reminder timing based on expected days-to-payment patterns in this client's industry vertical.</p>
                    `;
                    break;
                case 'overdue':
                    reasoningContent = `
                        <p>The Collections Agent is applying a sophisticated strategy to this overdue invoice based on multiple contextual factors:</p>
                        <ul>
                            <li>The client's historical payment data indicates this is unusual - they typically pay within ${Math.round(30 + Math.random() * 10)} days</li>
                            <li>Sentiment analysis of recent client communications shows normal tone with no signs of dissatisfaction</li>
                            <li>Customized reminder messaging emphasizes relationship value while clearly stating terms</li>
                            <li>The agent has determined that the optimal contact time is ${Math.random() < 0.5 ? 'morning' : 'afternoon'} based on previous response patterns</li>
                        </ul>
                        <p>Risk assessment indicates this is likely a process delay rather than financial distress, with a ${Math.round(70 + Math.random() * 20)}% probability of payment in the next 7 days.</p>
                    `;
                    break;
                case 'disputed':
                    reasoningContent = `
                        <p>The Dispute Resolution Agent is analyzing this disputed invoice using a complex reasoning process:</p>
                        <ul>
                            <li>NLP analysis of the dispute communication identified specific concern about ${Math.random() < 0.5 ? 'service quantity' : 'applied rates'}</li>
                            <li>Contract language analysis shows the applicable terms are in section ${Math.floor(Math.random() * 10) + 1}.${Math.floor(Math.random() * 10) + 1} of the master agreement</li>
                            <li>Historical context shows this client has disputed ${Math.floor(Math.random() * 3) + 1} similar invoices in the past ${Math.floor(Math.random() * 12) + 6} months</li>
                            <li>Resolution pattern analysis suggests a ${Math.round(50 + Math.random() * 40)}% probability this will be resolved in client's favor</li>
                        </ul>
                        <p>The agent is applying relationship value metrics to determine optimal resolution approach, balancing immediate revenue with long-term client value.</p>
                    `;
                    break;
                case 'paid':
                    reasoningContent = `
                        <p>The Reconciliation Agent applied sophisticated matching algorithms to process this payment:</p>
                        <ul>
                            <li>Payment reference data was partially incomplete, requiring probabilistic matching</li>
                            <li>The agent analyzed payment amount, timing, and client pattern to achieve a ${Math.round(90 + Math.random() * 9)}% confidence match</li>
                            <li>Machine learning models improved future matching accuracy by recording successful pattern</li>
                        </ul>
                        <p>Payment timing analysis shows this client paid ${invoice.daysToPayment < 30 ? 'earlier than typical' : 'within their normal window'} - this data informs DSO projections and cash flow forecasting models.</p>
                    `;
                    break;
            }
            
            modalReasoning.innerHTML = reasoningContent;
            
            // Show modal
            modal.style.display = 'block';
            
            // Close modal when clicking the X
            document.getElementById('invoice-details-close').addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Show invoice history modal
        function showInvoiceHistoryModal(invoiceId) {
            // Find the invoice
            const invoice = simulation.invoiceData.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            // Get modal elements
            const modal = document.getElementById('invoice-history-modal');
            const modalTitle = document.getElementById('invoice-history-title');
            const timelineContainer = document.getElementById('invoice-timeline');
            
            // Set modal title
            modalTitle.textContent = `Invoice ${invoice.id} - History Timeline`;
            
            // Sort history by date (oldest first)
            const sortedHistory = [...invoice.history].sort((a, b) => a.date - b.date);
            
            // Generate timeline HTML
            let timelineHTML = '';
            
            sortedHistory.forEach((event, index) => {
                // Get agent info
                const agentInfo = simulation.agents[event.agent];
                
                // Generate reasoning based on event status
                let reasoning = '';
                switch(event.status) {
                    case 'created':
                        reasoning = 'Invoice validation complete. All line items matched contracted rates and terms. Client agreement verified for billing compliance.';
                        break;
                    case 'sent':
                        reasoning = 'Invoice delivery timing optimized based on client\'s accounts payable processing schedule. Delivery method selected based on client preferences.';
                        break;
                    case 'paid':
                        reasoning = 'Payment successfully matched to invoice using reference data and amount pattern recognition. Client payment behavior consistent with historical patterns.';
                        break;
                    case 'disputed':
                        reasoning = 'Dispute categorized as billing question based on email content analysis. Historical context shows similar questions on previous invoices. Priority set to high based on client relationship value.';
                        break;
                    case 'overdue':
                        if (event.note.includes('reminder')) {
                            reasoning = 'Reminder timing and content personalized based on client\'s past response patterns. Tone adjusted to maintain positive relationship while emphasizing payment urgency.';
                        } else {
                            reasoning = 'Invoice flagged as overdue based on due date analysis. Risk assessment performed using client payment history and current outstanding balance.';
                        }
                        break;
                }
                
                // Determine if this is the active/most recent event
                const isActive = index === sortedHistory.length - 1;
                
                timelineHTML += `
                    <div class="timeline-item ${isActive ? 'active' : ''}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-date">${formatDate(event.date)}</div>
                        <div class="timeline-agent">
                            <span class="timeline-agent-icon">${agentInfo.icon}</span>
                            <span class="timeline-agent-name">${agentInfo.title}</span>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-action">${event.note}</div>
                            <div class="timeline-reasoning">${reasoning}</div>
                        </div>
                    </div>
                `;
            });
            
            // Set timeline content
            timelineContainer.innerHTML = timelineHTML;
            
            // Show modal
            modal.style.display = 'block';
            
            // Close modal when clicking the X
            document.getElementById('invoice-history-close').addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>